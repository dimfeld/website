---
title: "Plausible.io Custom URLs with SvelteKit"
tags: 
date: 2023-09-21
updated: 2023-09-21
draft: false
---


    
    <p><a href="https://plausible.io">Plausible Analytics</a> has a feature which lets you use custom URLs to help avoid adblockers and get better counts. Plausible is committed to respecting privacy, so I feel this is OK to do. (And they <a href="https://plausible.io/docs/proxy/introduction">address the topic here</a>).</p>
    <p>This site is built with SvelteKit and hosted on Vercel, and so none of the normal methods documented by Plausible work with this particular combination. But it&#39;s pretty simple to get going. Everything you see here except for the Vercel-specific edge function configuration will apply to other hosts too.</p>
    <p>We need two routes: one for the script itself, and another route to proxy events. I chose to place both of these routes under the <code>/plas</code> path.</p>
    <p>First, the path for the script itself.</p>
    <pre><code><span class="sy-source sy-js"><span class="sy-comment sy-line sy-double-slash sy-js"><span class="sy-punctuation sy-definition sy-comment sy-js">//</span> src/routes/plas/script.js/+server.ts
</span>
<span class="sy-meta sy-export sy-js"><span class="sy-keyword sy-control sy-import-export sy-js">export</span> <span class="sy-storage sy-type sy-js">const</span> <span class="sy-variable sy-other sy-readwrite sy-js">config</span> <span class="sy-keyword sy-operator sy-assignment sy-js">=</span> <span class="sy-meta sy-object-literal sy-js"><span class="sy-punctuation sy-section sy-block sy-js">{</span>
  <span class="sy-comment sy-line sy-double-slash sy-js"><span class="sy-punctuation sy-definition sy-comment sy-js">//</span> Vercel-specific
</span>  <span class="sy-meta sy-object-literal sy-key sy-js">runtime</span><span class="sy-punctuation sy-separator sy-key-value sy-js">:</span> <span class="sy-string sy-quoted sy-single sy-js"><span class="sy-punctuation sy-definition sy-string sy-begin sy-js">&#39;</span>edge<span class="sy-punctuation sy-definition sy-string sy-end sy-js">&#39;</span></span><span class="sy-punctuation sy-separator sy-comma sy-js">,</span>
<span class="sy-punctuation sy-section sy-block sy-js">}</span></span></span><span class="sy-punctuation sy-terminator sy-statement sy-js">;</span>

<span class="sy-meta sy-export sy-js"><span class="sy-keyword sy-control sy-import-export sy-js">export</span> <span class="sy-variable sy-other sy-readwrite sy-js">function</span> </span><span class="sy-meta sy-function-call sy-js"><span class="sy-variable sy-function sy-js">GET</span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">(</span><span class="sy-meta sy-object-literal sy-js"><span class="sy-punctuation sy-section sy-block sy-js">{</span> <span class="sy-variable sy-other sy-readwrite sy-js">fetch</span> <span class="sy-punctuation sy-section sy-block sy-js">}</span></span></span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">)</span></span></span> <span class="sy-meta sy-block sy-js"><span class="sy-punctuation sy-section sy-block sy-js">{</span>
  <span class="sy-keyword sy-control sy-flow sy-js">return</span> <span class="sy-meta sy-function-call sy-js"><span class="sy-variable sy-function sy-js">fetch</span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">(</span><span class="sy-string sy-quoted sy-single sy-js"><span class="sy-punctuation sy-definition sy-string sy-begin sy-js">&#39;</span>https://plausible.io/js/script.js<span class="sy-punctuation sy-definition sy-string sy-end sy-js">&#39;</span></span></span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">)</span></span></span><span class="sy-punctuation sy-terminator sy-statement sy-js">;</span>
<span class="sy-punctuation sy-section sy-block sy-js">}</span></span>
</span></code></pre>
    <p>This has a bit of configuration to run this route as an edge function, and then it just performs its own request for the actual Plausible script.</p>
    <p>Next, you need a route for the Plausible script to send events to. This is similar to the previous script, but it also passes the relevant headers and body from the client through to Plausible.</p>
    <pre><code><span class="sy-source sy-js"><span class="sy-comment sy-line sy-double-slash sy-js"><span class="sy-punctuation sy-definition sy-comment sy-js">//</span> src/routes/plas/event/+server.ts
</span>
<span class="sy-meta sy-export sy-js"><span class="sy-keyword sy-control sy-import-export sy-js">export</span> <span class="sy-storage sy-type sy-js">const</span> <span class="sy-variable sy-other sy-readwrite sy-js">config</span> <span class="sy-keyword sy-operator sy-assignment sy-js">=</span> <span class="sy-meta sy-object-literal sy-js"><span class="sy-punctuation sy-section sy-block sy-js">{</span>
  <span class="sy-comment sy-line sy-double-slash sy-js"><span class="sy-punctuation sy-definition sy-comment sy-js">//</span> Vercel-specific
</span>  <span class="sy-meta sy-object-literal sy-key sy-js">runtime</span><span class="sy-punctuation sy-separator sy-key-value sy-js">:</span> <span class="sy-string sy-quoted sy-single sy-js"><span class="sy-punctuation sy-definition sy-string sy-begin sy-js">&#39;</span>edge<span class="sy-punctuation sy-definition sy-string sy-end sy-js">&#39;</span></span><span class="sy-punctuation sy-separator sy-comma sy-js">,</span>
<span class="sy-punctuation sy-section sy-block sy-js">}</span></span></span><span class="sy-punctuation sy-terminator sy-statement sy-js">;</span>

<span class="sy-meta sy-export sy-js"><span class="sy-keyword sy-control sy-import-export sy-js">export</span> <span class="sy-variable sy-other sy-readwrite sy-js">async</span> </span><span class="sy-meta sy-function sy-declaration sy-js"><span class="sy-storage sy-type sy-function sy-js">function</span> <span class="sy-entity sy-name sy-function sy-js">POST</span><span class="sy-punctuation sy-section sy-group sy-begin sy-js">(</span><span class="sy-meta sy-block sy-js"><span class="sy-punctuation sy-section sy-block sy-begin sy-js">{</span> <span class="sy-variable sy-parameter sy-function sy-js">request</span><span class="sy-punctuation sy-separator sy-parameter sy-function sy-js">,</span> <span class="sy-variable sy-parameter sy-function sy-js">fetch</span> <span class="sy-punctuation sy-section sy-block sy-end sy-js">}</span></span><span class="sy-punctuation sy-section sy-group sy-end sy-js">)</span><span class="sy-meta sy-function sy-declaration sy-js"> </span></span><span class="sy-meta sy-block sy-js"><span class="sy-punctuation sy-section sy-block sy-js">{</span>
  <span class="sy-storage sy-type sy-js">let</span> <span class="sy-variable sy-other sy-readwrite sy-js">response</span> <span class="sy-keyword sy-operator sy-assignment sy-js">=</span> <span class="sy-meta sy-function-call sy-js"><span class="sy-variable sy-function sy-js">fetch</span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">(</span><span class="sy-string sy-quoted sy-single sy-js"><span class="sy-punctuation sy-definition sy-string sy-begin sy-js">&#39;</span>https://plausible.io/api/event<span class="sy-punctuation sy-definition sy-string sy-end sy-js">&#39;</span></span><span class="sy-punctuation sy-separator sy-comma sy-js">,</span> <span class="sy-meta sy-object-literal sy-js"><span class="sy-punctuation sy-section sy-block sy-js">{</span>
    <span class="sy-meta sy-object-literal sy-key sy-js">method</span><span class="sy-punctuation sy-separator sy-key-value sy-js">:</span> <span class="sy-variable sy-other sy-object sy-js">request</span><span class="sy-punctuation sy-accessor sy-js">.</span><span class="sy-meta sy-property sy-object sy-js">method</span><span class="sy-punctuation sy-separator sy-comma sy-js">,</span>
    <span class="sy-meta sy-object-literal sy-key sy-js">headers</span><span class="sy-punctuation sy-separator sy-key-value sy-js">:</span> <span class="sy-variable sy-other sy-object sy-js">request</span><span class="sy-punctuation sy-accessor sy-js">.</span><span class="sy-meta sy-property sy-object sy-js">headers</span><span class="sy-punctuation sy-separator sy-comma sy-js">,</span>
    <span class="sy-meta sy-object-literal sy-key sy-js">body</span><span class="sy-punctuation sy-separator sy-key-value sy-js">:</span> <span class="sy-variable sy-other sy-object sy-js">request</span><span class="sy-punctuation sy-accessor sy-js">.</span><span class="sy-meta sy-property sy-object sy-js">body</span><span class="sy-punctuation sy-separator sy-comma sy-js">,</span>
  <span class="sy-punctuation sy-section sy-block sy-js">}</span></span></span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">)</span></span></span><span class="sy-punctuation sy-terminator sy-statement sy-js">;</span>

  <span class="sy-keyword sy-control sy-flow sy-js">return</span> <span class="sy-variable sy-other sy-readwrite sy-js">response</span><span class="sy-punctuation sy-terminator sy-statement sy-js">;</span>
<span class="sy-punctuation sy-section sy-block sy-js">}</span></span>

</span></code></pre>
    <p>Finally, in <code>app.html</code> we just include the script, with the appropriate paths for the script and event routes.</p>
    <pre><code><span class="sy-text sy-html sy-basic"><span class="sy-meta sy-tag sy-sgml sy-html"><span class="sy-punctuation sy-definition sy-tag sy-html">&lt;!</span><span class="sy-meta sy-tag sy-sgml sy-doctype sy-html"><span class="sy-entity sy-name sy-tag sy-doctype sy-html">DOCTYPE</span> html</span><span class="sy-punctuation sy-definition sy-tag sy-html">&gt;</span></span>
<span class="sy-meta sy-tag sy-structure sy-any sy-html"><span class="sy-punctuation sy-definition sy-tag sy-begin sy-html">&lt;</span><span class="sy-entity sy-name sy-tag sy-structure sy-any sy-html">html</span> <span class="sy-meta sy-attribute-with-value sy-html"><span class="sy-entity sy-other sy-attribute-name sy-html">lang</span><span class="sy-punctuation sy-separator sy-key-value sy-html">=</span></span><span class="sy-meta sy-attribute-with-value sy-html"><span class="sy-string sy-quoted sy-double sy-html"><span class="sy-punctuation sy-definition sy-string sy-begin sy-html">&quot;</span>en<span class="sy-punctuation sy-definition sy-string sy-end sy-html">&quot;</span></span></span><span class="sy-punctuation sy-definition sy-tag sy-end sy-html">&gt;</span></span>
  <span class="sy-meta sy-tag sy-structure sy-any sy-html"><span class="sy-punctuation sy-definition sy-tag sy-begin sy-html">&lt;</span><span class="sy-entity sy-name sy-tag sy-structure sy-any sy-html">head</span><span class="sy-punctuation sy-definition sy-tag sy-end sy-html">&gt;</span></span>
    <span class="sy-comment sy-block sy-html"><span class="sy-punctuation sy-definition sy-comment sy-begin sy-html">&lt;!--</span> Other head contents <span class="sy-punctuation sy-definition sy-comment sy-end sy-html">--&gt;</span></span>
    <span class="sy-meta sy-tag sy-script sy-begin sy-html"><span class="sy-punctuation sy-definition sy-tag sy-begin sy-html">&lt;</span><span class="sy-entity sy-name sy-tag sy-script sy-html">script</span></span><span class="sy-meta sy-tag sy-script sy-begin sy-html">
      <span class="sy-entity sy-other sy-attribute-name sy-html">async</span>
      <span class="sy-entity sy-other sy-attribute-name sy-html">defer</span>
      <span class="sy-meta sy-attribute-with-value sy-html"><span class="sy-entity sy-other sy-attribute-name sy-html">data-domain</span><span class="sy-punctuation sy-separator sy-key-value sy-html">=</span></span><span class="sy-meta sy-attribute-with-value sy-html"><span class="sy-string sy-quoted sy-double sy-html"><span class="sy-punctuation sy-definition sy-string sy-begin sy-html">&quot;</span>your-domain.com<span class="sy-punctuation sy-definition sy-string sy-end sy-html">&quot;</span></span></span>
      <span class="sy-meta sy-attribute-with-value sy-html"><span class="sy-entity sy-other sy-attribute-name sy-html">data-api</span><span class="sy-punctuation sy-separator sy-key-value sy-html">=</span></span><span class="sy-meta sy-attribute-with-value sy-html"><span class="sy-string sy-quoted sy-double sy-html"><span class="sy-punctuation sy-definition sy-string sy-begin sy-html">&quot;</span>/plas/event<span class="sy-punctuation sy-definition sy-string sy-end sy-html">&quot;</span></span></span>
      <span class="sy-meta sy-attribute-with-value sy-html"><span class="sy-entity sy-other sy-attribute-name sy-html">src</span><span class="sy-punctuation sy-separator sy-key-value sy-html">=</span></span><span class="sy-meta sy-attribute-with-value sy-html"><span class="sy-string sy-quoted sy-double sy-html"><span class="sy-punctuation sy-definition sy-string sy-begin sy-html">&quot;</span>/plas/script.js<span class="sy-punctuation sy-definition sy-string sy-end sy-html">&quot;</span></span></span>
    </span><span class="sy-meta sy-tag sy-script sy-begin sy-html"><span class="sy-punctuation sy-definition sy-tag sy-end sy-html">&gt;</span></span><span class="sy-source sy-js sy-embedded sy-html"></span><span class="sy-meta sy-tag sy-script sy-end sy-html"><span class="sy-punctuation sy-definition sy-tag sy-begin sy-html">&lt;/</span><span class="sy-entity sy-name sy-tag sy-script sy-html">script</span><span class="sy-punctuation sy-definition sy-tag sy-end sy-html">&gt;</span></span>
  <span class="sy-meta sy-tag sy-structure sy-any sy-html"><span class="sy-punctuation sy-definition sy-tag sy-begin sy-html">&lt;/</span><span class="sy-entity sy-name sy-tag sy-structure sy-any sy-html">head</span><span class="sy-punctuation sy-definition sy-tag sy-end sy-html">&gt;</span></span>
  <span class="sy-meta sy-tag sy-structure sy-any sy-html"><span class="sy-punctuation sy-definition sy-tag sy-begin sy-html">&lt;</span><span class="sy-entity sy-name sy-tag sy-structure sy-any sy-html">body</span><span class="sy-punctuation sy-definition sy-tag sy-end sy-html">&gt;</span></span><span class="sy-comment sy-block sy-html"><span class="sy-punctuation sy-definition sy-comment sy-begin sy-html">&lt;!--</span> body contents <span class="sy-punctuation sy-definition sy-comment sy-end sy-html">--&gt;</span></span><span class="sy-meta sy-tag sy-structure sy-any sy-html"><span class="sy-punctuation sy-definition sy-tag sy-begin sy-html">&lt;/</span><span class="sy-entity sy-name sy-tag sy-structure sy-any sy-html">body</span><span class="sy-punctuation sy-definition sy-tag sy-end sy-html">&gt;</span></span>
<span class="sy-meta sy-tag sy-structure sy-any sy-html"><span class="sy-punctuation sy-definition sy-tag sy-begin sy-html">&lt;/</span><span class="sy-entity sy-name sy-tag sy-structure sy-any sy-html">html</span><span class="sy-punctuation sy-definition sy-tag sy-end sy-html">&gt;</span></span>

</span></code></pre>
    <p>And that&#39;s it!</p>



