---
title: "2022-11-23"
tags: 
date: 2022-11-23
updated: 2022-11-24
---


  <ul class="list-document">
    <li><span class="text-lg">Learning</span>
      <ul class="list-document">
        <li>In getting S3 upload for <a href="/notes/projects_pic_store">Pic Store</a> to work, I found that DigitalOcean Spaces defaults all files to private, with no way to change the default from the web UI. But you can use <code>s3cmd</code> to do it by setting the S3 bucket policy. First, create a policy JSON file:</li>
        <li><pre><code><span class="hljs-source hljs-json"><span class="hljs-meta hljs-structure hljs-dictionary hljs-json"><span class="hljs-punctuation hljs-section hljs-dictionary hljs-begin hljs-json">{</span>
    <span class="hljs-meta hljs-structure hljs-dictionary hljs-key hljs-json"><span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>Version<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span></span><span class="hljs-meta hljs-structure hljs-dictionary hljs-value hljs-json"><span class="hljs-punctuation hljs-separator hljs-dictionary hljs-key-value hljs-json">:</span> <span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>2008-10-17<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span><span class="hljs-punctuation hljs-separator hljs-dictionary hljs-pair hljs-json">,</span></span>
    <span class="hljs-meta hljs-structure hljs-dictionary hljs-key hljs-json"><span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>Statement<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span></span><span class="hljs-meta hljs-structure hljs-dictionary hljs-value hljs-json"><span class="hljs-punctuation hljs-separator hljs-dictionary hljs-key-value hljs-json">:</span> <span class="hljs-meta hljs-structure hljs-array hljs-json"><span class="hljs-punctuation hljs-section hljs-array hljs-begin hljs-json">[</span>
        <span class="hljs-meta hljs-structure hljs-dictionary hljs-json"><span class="hljs-punctuation hljs-section hljs-dictionary hljs-begin hljs-json">{</span>
        <span class="hljs-meta hljs-structure hljs-dictionary hljs-key hljs-json"><span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>Sid<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span></span><span class="hljs-meta hljs-structure hljs-dictionary hljs-value hljs-json"><span class="hljs-punctuation hljs-separator hljs-dictionary hljs-key-value hljs-json">:</span> <span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>AddPerm<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span><span class="hljs-punctuation hljs-separator hljs-dictionary hljs-pair hljs-json">,</span></span>
        <span class="hljs-meta hljs-structure hljs-dictionary hljs-key hljs-json"><span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>Effect<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span></span><span class="hljs-meta hljs-structure hljs-dictionary hljs-value hljs-json"><span class="hljs-punctuation hljs-separator hljs-dictionary hljs-key-value hljs-json">:</span> <span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>Allow<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span><span class="hljs-punctuation hljs-separator hljs-dictionary hljs-pair hljs-json">,</span></span>
        <span class="hljs-meta hljs-structure hljs-dictionary hljs-key hljs-json"><span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>Principal<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span></span><span class="hljs-meta hljs-structure hljs-dictionary hljs-value hljs-json"><span class="hljs-punctuation hljs-separator hljs-dictionary hljs-key-value hljs-json">:</span> <span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>*<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span><span class="hljs-punctuation hljs-separator hljs-dictionary hljs-pair hljs-json">,</span></span>
        <span class="hljs-meta hljs-structure hljs-dictionary hljs-key hljs-json"><span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>Action<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span></span><span class="hljs-meta hljs-structure hljs-dictionary hljs-value hljs-json"><span class="hljs-punctuation hljs-separator hljs-dictionary hljs-key-value hljs-json">:</span> <span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>s3:GetObject<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span><span class="hljs-punctuation hljs-separator hljs-dictionary hljs-pair hljs-json">,</span></span>
        <span class="hljs-meta hljs-structure hljs-dictionary hljs-key hljs-json"><span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>Resource<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span></span><span class="hljs-meta hljs-structure hljs-dictionary hljs-value hljs-json"><span class="hljs-punctuation hljs-separator hljs-dictionary hljs-key-value hljs-json">:</span> <span class="hljs-string hljs-quoted hljs-double hljs-json"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-json">&quot;</span>arn:aws:s3::YOUR_BUCKET_NAME/*<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-json">&quot;</span></span>
        </span><span class="hljs-punctuation hljs-section hljs-dictionary hljs-end hljs-json">}</span></span>
    <span class="hljs-punctuation hljs-section hljs-array hljs-end hljs-json">]</span></span>
</span><span class="hljs-punctuation hljs-section hljs-dictionary hljs-end hljs-json">}</span></span>

</span></code></pre></li>
        <li>Then you can apply it to the bucket like so:</li>
        <li><pre><code><span class="hljs-source hljs-shell hljs-bash"><span class="hljs-meta hljs-function-call hljs-shell"><span class="hljs-variable hljs-function hljs-shell">s3cmd</span></span><span class="hljs-meta hljs-function-call hljs-arguments hljs-shell"><span class="hljs-variable hljs-parameter hljs-option hljs-shell"><span class="hljs-punctuation hljs-definition hljs-parameter hljs-shell"> --</span>access_key</span><span class="hljs-keyword hljs-operator hljs-assignment hljs-option hljs-shell">=</span><span class="hljs-meta hljs-group hljs-expansion hljs-parameter hljs-shell"><span class="hljs-punctuation hljs-definition hljs-variable hljs-shell">$</span><span class="hljs-variable hljs-other hljs-readwrite hljs-shell">ACCESS_KEY</span></span><span class="hljs-variable hljs-parameter hljs-option hljs-shell"><span class="hljs-punctuation hljs-definition hljs-parameter hljs-shell"> --</span>secret_key</span><span class="hljs-keyword hljs-operator hljs-assignment hljs-option hljs-shell">=</span><span class="hljs-meta hljs-group hljs-expansion hljs-parameter hljs-shell"><span class="hljs-punctuation hljs-definition hljs-variable hljs-shell">$</span><span class="hljs-variable hljs-other hljs-readwrite hljs-shell">SECRET_KEY</span></span> <span class="hljs-punctuation hljs-separator hljs-continuation hljs-line hljs-shell">\
</span><span class="hljs-variable hljs-parameter hljs-option hljs-shell"><span class="hljs-punctuation hljs-definition hljs-parameter hljs-shell">    --</span>host</span><span class="hljs-keyword hljs-operator hljs-assignment hljs-option hljs-shell">=</span><span class="hljs-meta hljs-group hljs-expansion hljs-parameter hljs-shell"><span class="hljs-punctuation hljs-definition hljs-variable hljs-shell">$</span><span class="hljs-variable hljs-other hljs-readwrite hljs-shell">REGION</span></span>.digitaloceanspaces.com <span class="hljs-punctuation hljs-separator hljs-continuation hljs-line hljs-shell">\
</span><span class="hljs-variable hljs-parameter hljs-option hljs-shell"><span class="hljs-punctuation hljs-definition hljs-parameter hljs-shell">    --</span>host-bucket</span><span class="hljs-keyword hljs-operator hljs-assignment hljs-option hljs-shell">=</span><span class="hljs-meta hljs-group hljs-expansion hljs-parameter hljs-shell"><span class="hljs-punctuation hljs-definition hljs-variable hljs-shell">$</span><span class="hljs-variable hljs-other hljs-readwrite hljs-shell">BUCKET</span></span>.<span class="hljs-meta hljs-group hljs-expansion hljs-parameter hljs-shell"><span class="hljs-punctuation hljs-definition hljs-variable hljs-shell">$</span><span class="hljs-variable hljs-other hljs-readwrite hljs-shell">REGION</span></span>.digitaloceanspaces.com <span class="hljs-punctuation hljs-separator hljs-continuation hljs-line hljs-shell">\
</span><span class="hljs-variable hljs-parameter hljs-option hljs-shell"><span class="hljs-punctuation hljs-definition hljs-parameter hljs-shell">    --</span>region</span> <span class="hljs-meta hljs-group hljs-expansion hljs-parameter hljs-shell"><span class="hljs-punctuation hljs-definition hljs-variable hljs-shell">$</span><span class="hljs-variable hljs-other hljs-readwrite hljs-shell">REGION</span></span> <span class="hljs-punctuation hljs-separator hljs-continuation hljs-line hljs-shell">\
</span>    setpolicy policy.json s3://<span class="hljs-meta hljs-group hljs-expansion hljs-parameter hljs-shell"><span class="hljs-punctuation hljs-definition hljs-variable hljs-shell">$</span><span class="hljs-variable hljs-other hljs-readwrite hljs-shell">BUCKET</span></span> <span class="hljs-punctuation hljs-separator hljs-continuation hljs-line hljs-shell">\
</span><span class="hljs-variable hljs-parameter hljs-option hljs-shell"><span class="hljs-punctuation hljs-definition hljs-parameter hljs-shell">    --</span>acl-public</span></span>
</span></code></pre></li>
        <li>It&#39;s a bit quirky, as the DO web interface still shows the files as private, but they are actually public, and this public status also applies to files uploaded in the future.</li>
        <li>Many thanks to <a href="https://hugo.md/post/setting-bucket-policy-digital-ocean-spaces/">Hugo</a> for the solution.</li>
      </ul>
    </li>
  </ul>


