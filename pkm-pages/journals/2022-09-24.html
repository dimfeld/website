---
title: "2022-09-24"
tags: 
date: 2022-09-24
updated: 2022-09-26
---


    
    <p>Finished this iteration of the blog update. With the new SvelteKit version I had to update my janky method of getting the social card generator WASM and fonts into the Vercel deploy. Wasn&#39;t too bad overall though. The main trick is to read files from the working directory when in Vercel, and otherwise read from whereever the files are on your local computer.</p>
    <p><pre><code><span class="sy-source sy-js"><span class="sy-storage sy-type sy-js">const</span> <span class="sy-variable sy-other sy-readwrite sy-js">dirname</span> <span class="sy-keyword sy-operator sy-assignment sy-js">=</span> <span class="sy-support sy-type sy-object sy-process sy-js">process</span><span class="sy-punctuation sy-accessor sy-js">.</span><span class="sy-support sy-type sy-object sy-process sy-js">env</span><span class="sy-punctuation sy-accessor sy-js">.</span><span class="sy-meta sy-property sy-object sy-js">VERCEL</span>
  <span class="sy-keyword sy-operator sy-ternary sy-js">?</span> <span class="sy-meta sy-function-call sy-method sy-js"><span class="sy-support sy-type sy-object sy-process sy-js">process</span><span class="sy-punctuation sy-accessor sy-js">.</span><span class="sy-support sy-function sy-process sy-js">cwd</span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">(</span></span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">)</span></span></span>
  <span class="sy-keyword sy-operator sy-ternary sy-js">:</span> <span class="sy-variable sy-other sy-object sy-js">path</span><span class="sy-punctuation sy-accessor sy-js">.</span><span class="sy-meta sy-function-call sy-method sy-js"><span class="sy-variable sy-function sy-js">dirname</span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">(</span><span class="sy-meta sy-function-call sy-js"><span class="sy-variable sy-function sy-js">fileURLToPath</span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">(</span><span class="sy-variable sy-other sy-object sy-js">import</span><span class="sy-punctuation sy-accessor sy-js">.</span><span class="sy-meta sy-property sy-object sy-js">meta</span><span class="sy-punctuation sy-accessor sy-js">.</span><span class="sy-meta sy-property sy-object sy-js">url</span></span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">)</span></span></span></span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">)</span></span></span><span class="sy-punctuation sy-terminator sy-statement sy-js">;</span>

<span class="sy-variable sy-other sy-object sy-js">fs</span><span class="sy-punctuation sy-accessor sy-js">.</span><span class="sy-meta sy-function-call sy-method sy-js"><span class="sy-variable sy-function sy-js">readFileSync</span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">(</span><span class="sy-variable sy-other sy-object sy-js">path</span><span class="sy-punctuation sy-accessor sy-js">.</span><span class="sy-meta sy-function-call sy-method sy-js"><span class="sy-variable sy-function sy-js">join</span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">(</span><span class="sy-variable sy-other sy-readwrite sy-js">dirname</span><span class="sy-punctuation sy-separator sy-comma sy-js">,</span> <span class="sy-string sy-quoted sy-single sy-js"><span class="sy-punctuation sy-definition sy-string sy-begin sy-js">&#39;</span>font.ttf<span class="sy-punctuation sy-definition sy-string sy-end sy-js">&#39;</span></span></span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">)</span></span></span></span><span class="sy-meta sy-group sy-js"><span class="sy-punctuation sy-section sy-group sy-js">)</span></span></span><span class="sy-punctuation sy-terminator sy-statement sy-js">;</span>
</span></code></pre></p>
    <p>Then finally, update your build command to not only run vite build, but also copy the files into the Vercel output:</p>
    <p><pre><code><span class="sy-source sy-shell sy-bash"><span class="sy-meta sy-function-call sy-shell"><span class="sy-variable sy-function sy-shell">vite</span></span><span class="sy-meta sy-function-call sy-arguments sy-shell"> build</span> <span class="sy-keyword sy-operator sy-logical sy-and sy-shell">&amp;&amp;</span> <span class="sy-punctuation sy-separator sy-continuation sy-line sy-shell">\
</span>  <span class="sy-meta sy-function-call sy-shell"><span class="sy-variable sy-function sy-shell">cp</span></span><span class="sy-meta sy-function-call sy-arguments sy-shell"> ./src/lib/og-image/<span class="sy-keyword sy-operator sy-regexp sy-quantifier sy-shell">*</span>.ttf <span class="sy-punctuation sy-separator sy-continuation sy-line sy-shell">\
</span>     ./.vercel/output/functions/render.func/</span>
</span></code></pre></p>
    <p>Not pretty and rather fragile, but it works for now.</p>
    <p>Now that I have this &quot;journal&quot; functionality, next up will be some automatic tagging and an index sidebar for the journals. But at least it&#39;s finished enough now that I have a low-friction writing process for short stuff, since I haven&#39;t done any real writing in almost a year.</p>



