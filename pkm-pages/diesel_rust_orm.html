---
title: "Diesel Rust ORM"
tags: Rust
date: 2022-07-04
updated: 2022-07-11
---


  <ul class="list-bullet">
    <li><span><span class="font-medium text-gray-800">Website:</span> <span><a href="https://diesel.rs/">https://diesel.rs/</a></span></span></li>
    <li>Useful other crates
      <ul class="list-bullet">
        <li><a href="https://docs.rs/diesel-derive-enum/latest/diesel_derive_enum/">`diesel-derive-enum`</a> helps with translating between Rust enums and database enum types.</li>
        <li>Although Diesel doesn&#39;t support async natively, there are many packages that enable that support with minimal fuss. I&#39;ve been using <a href="https://docs.rs/deadpool-diesel/latest/deadpool_diesel/">`deadpool-diesel`</a>.</li>
      </ul>
    </li>
    <li>Selecting into other structures
      <ul class="list-bullet">
        <li>When creating a reusable structure to select into that isn&#39;t the normal one, you can derive <code>Selectable</code> and then use <code>type::as_select()</code> to return the list of columns for a select column. Note that this structure must also implement <code>Queryable</code>.</li>
        <li>This is useful, for example, for structures that include the columns of a database table that the user should be able to see, while omitting internal data.</li>
        <li><pre><code><span class="hljs-source hljs-rust"><span class="hljs-keyword hljs-other hljs-rust">use</span> <span class="hljs-keyword hljs-other hljs-rust">crate</span><span class="hljs-meta hljs-path hljs-rust"><span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">schema<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>the_table<span class="hljs-punctuation hljs-terminator hljs-rust">;</span>

<span class="hljs-meta hljs-annotation hljs-rust"><span class="hljs-punctuation hljs-definition hljs-annotation hljs-rust">#</span><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">[</span><span class="hljs-variable hljs-annotation hljs-rust">derive</span><span class="hljs-meta hljs-annotation hljs-parameters hljs-rust"><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span></span></span><span class="hljs-meta hljs-annotation hljs-parameters hljs-rust"><span class="hljs-meta hljs-group hljs-rust">Debug<span class="hljs-punctuation hljs-separator hljs-rust">,</span> Queryable<span class="hljs-punctuation hljs-separator hljs-rust">,</span> Selectable</span></span><span class="hljs-meta hljs-annotation hljs-parameters hljs-rust"><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span></span><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">]</span></span>
<span class="hljs-meta hljs-annotation hljs-rust"><span class="hljs-punctuation hljs-definition hljs-annotation hljs-rust">#</span><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">[</span><span class="hljs-variable hljs-annotation hljs-rust">diesel</span><span class="hljs-meta hljs-annotation hljs-parameters hljs-rust"><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span></span></span><span class="hljs-meta hljs-annotation hljs-parameters hljs-rust"><span class="hljs-meta hljs-group hljs-rust">table_name <span class="hljs-keyword hljs-operator hljs-rust">=</span> the_table</span></span><span class="hljs-meta hljs-annotation hljs-parameters hljs-rust"><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span></span><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">]</span></span>
<span class="hljs-meta hljs-struct hljs-rust"><span class="hljs-storage hljs-modifier hljs-rust">pub</span> <span class="hljs-storage hljs-type hljs-struct hljs-rust">struct</span> </span><span class="hljs-meta hljs-struct hljs-rust"><span class="hljs-entity hljs-name hljs-struct hljs-rust">PublicData</span> </span><span class="hljs-meta hljs-struct hljs-rust"><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-begin hljs-rust">{</span>
	<span class="hljs-storage hljs-modifier hljs-rust">pub</span> <span class="hljs-variable hljs-other hljs-member hljs-rust">id</span><span class="hljs-punctuation hljs-separator hljs-rust">:</span> <span class="hljs-storage hljs-type hljs-rust">i32</span>,
    <span class="hljs-storage hljs-modifier hljs-rust">pub</span> <span class="hljs-variable hljs-other hljs-member hljs-rust">name</span><span class="hljs-punctuation hljs-separator hljs-rust">:</span> String,
    <span class="hljs-storage hljs-modifier hljs-rust">pub</span> <span class="hljs-variable hljs-other hljs-member hljs-rust">owner</span><span class="hljs-punctuation hljs-separator hljs-rust">:</span> String,
</span><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-end hljs-rust">}</span></span></span>

<span class="hljs-meta hljs-function hljs-rust"><span class="hljs-meta hljs-function hljs-rust"><span class="hljs-storage hljs-modifier hljs-rust">pub</span> <span class="hljs-storage hljs-type hljs-function hljs-rust">fn</span> </span><span class="hljs-entity hljs-name hljs-function hljs-rust">get_public_data</span></span><span class="hljs-meta hljs-function hljs-rust"><span class="hljs-meta hljs-function hljs-parameters hljs-rust"><span class="hljs-punctuation hljs-section hljs-parameters hljs-begin hljs-rust">(</span><span class="hljs-variable hljs-parameter hljs-rust">id</span><span class="hljs-punctuation hljs-separator hljs-rust">:</span> <span class="hljs-storage hljs-type hljs-rust">i32</span></span><span class="hljs-meta hljs-function hljs-rust"><span class="hljs-meta hljs-function hljs-parameters hljs-rust"><span class="hljs-punctuation hljs-section hljs-parameters hljs-end hljs-rust">)</span></span></span></span><span class="hljs-meta hljs-function hljs-rust"> <span class="hljs-meta hljs-function hljs-return-type hljs-rust"><span class="hljs-punctuation hljs-separator hljs-rust">-&gt;</span> <span class="hljs-meta hljs-generic hljs-rust">Result<span class="hljs-punctuation hljs-definition hljs-generic hljs-begin hljs-rust">&lt;</span>PartialResult, <span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">result<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>error<span class="hljs-punctuation hljs-definition hljs-generic hljs-end hljs-rust">&gt;</span></span></span> </span><span class="hljs-meta hljs-function hljs-rust"><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-begin hljs-rust">{</span>
    <span class="hljs-meta hljs-path hljs-rust">the_table<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>table
      .<span class="hljs-support hljs-function hljs-rust">find</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span>id</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span>
      .<span class="hljs-support hljs-function hljs-rust">select</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span><span class="hljs-meta hljs-path hljs-rust">PartialResult<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>as_select<span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span>
      .<span class="hljs-meta hljs-path hljs-rust">first<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-generic hljs-rust"><span class="hljs-punctuation hljs-definition hljs-generic hljs-begin hljs-rust">&lt;</span>PartialResult<span class="hljs-punctuation hljs-definition hljs-generic hljs-end hljs-rust">&gt;</span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span>
</span><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-end hljs-rust">}</span></span></span>
</span></code></pre></li>
      </ul>
    </li>
    <li>JSON Deserializing
      <ul class="list-bullet">
        <li>One of diesel&#39;s design decisions is that it will never include any translation code that could fail to serialize or deserialize data from the database. As such, they do not natively support translating from JSON types into Rust structs using the <code>Deserialize</code> attribute. However, this can be implemented generically with a macro, such as this one which converts between the Rust struct and a PostgreSQL JSONB column.</li>
        <li><pre><code><span class="hljs-source hljs-rust"><span class="hljs-meta hljs-annotation hljs-rust"><span class="hljs-punctuation hljs-definition hljs-annotation hljs-rust">#</span><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">[</span><span class="hljs-variable hljs-annotation hljs-rust">macro_export</span><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">]</span></span>
<span class="hljs-meta hljs-macro hljs-rust"><span class="hljs-support hljs-function hljs-rust">macro_rules!</span> <span class="hljs-entity hljs-name hljs-macro hljs-rust">diesel_jsonb</span> <span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-begin hljs-rust">{</span>
    <span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span>$type: ty<span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span> <span class="hljs-keyword hljs-operator hljs-rust">=&gt;</span> <span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-begin hljs-rust">{</span>
        <span class="hljs-meta hljs-impl hljs-rust"><span class="hljs-storage hljs-type hljs-impl hljs-rust">impl</span> </span><span class="hljs-meta hljs-impl hljs-rust"><span class="hljs-meta hljs-path hljs-rust"><span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">deserialize<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-generic hljs-rust">FromSql<span class="hljs-punctuation hljs-definition hljs-generic hljs-begin hljs-rust">&lt;</span><span class="hljs-meta hljs-path hljs-rust"><span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">sql_types<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>Jsonb, <span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">pg<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>Pg<span class="hljs-punctuation hljs-definition hljs-generic hljs-end hljs-rust">&gt;</span></span> <span class="hljs-keyword hljs-other hljs-rust">for</span></span><span class="hljs-meta hljs-impl hljs-rust"> <span class="hljs-variable hljs-other hljs-rust">$type</span> </span><span class="hljs-meta hljs-impl hljs-rust"><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-begin hljs-rust">{</span>
            <span class="hljs-meta hljs-function hljs-rust"><span class="hljs-meta hljs-function hljs-rust"><span class="hljs-storage hljs-type hljs-function hljs-rust">fn</span> </span><span class="hljs-entity hljs-name hljs-function hljs-rust">from_sql</span></span><span class="hljs-meta hljs-function hljs-rust"><span class="hljs-meta hljs-function hljs-parameters hljs-rust"><span class="hljs-punctuation hljs-section hljs-parameters hljs-begin hljs-rust">(</span>
                <span class="hljs-variable hljs-parameter hljs-rust">value</span><span class="hljs-punctuation hljs-separator hljs-rust">:</span> <span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">backend<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-generic hljs-rust">RawValue<span class="hljs-punctuation hljs-definition hljs-generic hljs-begin hljs-rust">&lt;</span>&#39;<span class="hljs-keyword hljs-operator hljs-rust">_</span>, <span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">pg<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>Pg<span class="hljs-punctuation hljs-definition hljs-generic hljs-end hljs-rust">&gt;</span></span>,
            </span><span class="hljs-meta hljs-function hljs-rust"><span class="hljs-meta hljs-function hljs-parameters hljs-rust"><span class="hljs-punctuation hljs-section hljs-parameters hljs-end hljs-rust">)</span></span></span></span><span class="hljs-meta hljs-function hljs-rust"> <span class="hljs-meta hljs-function hljs-return-type hljs-rust"><span class="hljs-punctuation hljs-separator hljs-rust">-&gt;</span> <span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">deserialize<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-generic hljs-rust">Result<span class="hljs-punctuation hljs-definition hljs-generic hljs-begin hljs-rust">&lt;</span><span class="hljs-storage hljs-type hljs-rust">Self</span><span class="hljs-punctuation hljs-definition hljs-generic hljs-end hljs-rust">&gt;</span></span></span> </span><span class="hljs-meta hljs-function hljs-rust"><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-begin hljs-rust">{</span>
                <span class="hljs-storage hljs-type hljs-rust">let</span> bytes <span class="hljs-keyword hljs-operator hljs-rust">=</span> value.<span class="hljs-support hljs-function hljs-rust">as_bytes</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span><span class="hljs-punctuation hljs-terminator hljs-rust">;</span>
                <span class="hljs-keyword hljs-control hljs-rust">if</span> bytes<span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">[</span><span class="hljs-constant hljs-numeric hljs-integer hljs-decimal hljs-rust">0</span><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">]</span></span> <span class="hljs-keyword hljs-operator hljs-rust">!</span><span class="hljs-keyword hljs-operator hljs-rust">=</span> <span class="hljs-constant hljs-numeric hljs-integer hljs-decimal hljs-rust">1</span> <span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-begin hljs-rust">{</span>
                    <span class="hljs-keyword hljs-control hljs-rust">return</span> <span class="hljs-support hljs-type hljs-rust">Err</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span><span class="hljs-string hljs-quoted hljs-double hljs-rust"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-rust">&quot;</span>Unsupported JSONB encoding version<span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-rust">&quot;</span></span>.<span class="hljs-support hljs-function hljs-rust">into</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span><span class="hljs-punctuation hljs-terminator hljs-rust">;</span>
                </span><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-end hljs-rust">}</span></span>

                <span class="hljs-meta hljs-path hljs-rust"><span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">serde_json<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>from_slice<span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span><span class="hljs-keyword hljs-operator hljs-rust">&amp;</span>bytes<span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">[</span><span class="hljs-constant hljs-numeric hljs-integer hljs-decimal hljs-rust">1</span><span class="hljs-keyword hljs-operator hljs-rust">..</span><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">]</span></span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span>
                    .<span class="hljs-support hljs-function hljs-rust">map_err</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span><span class="hljs-meta hljs-function hljs-closure hljs-rust"><span class="hljs-meta hljs-function hljs-parameters hljs-rust"><span class="hljs-punctuation hljs-section hljs-parameters hljs-begin hljs-rust">|</span></span></span><span class="hljs-meta hljs-function hljs-closure hljs-rust"><span class="hljs-meta hljs-function hljs-parameters hljs-rust"><span class="hljs-variable hljs-parameter hljs-rust">e</span><span class="hljs-punctuation hljs-section hljs-parameters hljs-end hljs-rust">|</span></span> </span><span class="hljs-meta hljs-function hljs-closure hljs-rust"><span class="hljs-support hljs-macro hljs-rust">format!</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-string hljs-quoted hljs-double hljs-rust"><span class="hljs-punctuation hljs-definition hljs-string hljs-begin hljs-rust">&quot;</span>Invalid JSON: <span class="hljs-constant hljs-other hljs-placeholder hljs-rust">{}</span><span class="hljs-punctuation hljs-definition hljs-string hljs-end hljs-rust">&quot;</span></span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-separator hljs-rust">,</span> e<span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span>.<span class="hljs-support hljs-function hljs-rust">into</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span></span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span>
                
                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span> This version uses Diesel&#39;s internal translation to serde_json::Value instead,
</span>                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span> which is simpler but involves an intermediate step of materializing the value as a
</span>                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span> serde_json::Value.
</span>                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span> let value = &lt;serde_json::Value as ::diesel::deserialize::FromSql&lt;
</span>                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span>     ::diesel::sql_types::Jsonb,
</span>                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span>     ::diesel::pg::Pg,
</span>                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span> &gt;&gt;::from_sql(value)?;
</span>                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span> Ok(serde_json::from_value(value)?)
</span>            </span><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-end hljs-rust">}</span></span></span>
        </span><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-end hljs-rust">}</span></span></span>

        <span class="hljs-meta hljs-impl hljs-rust"><span class="hljs-storage hljs-type hljs-impl hljs-rust">impl</span> </span><span class="hljs-meta hljs-impl hljs-rust"><span class="hljs-meta hljs-path hljs-rust"><span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">serialize<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-generic hljs-rust">ToSql<span class="hljs-punctuation hljs-definition hljs-generic hljs-begin hljs-rust">&lt;</span><span class="hljs-meta hljs-path hljs-rust"><span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">sql_types<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>Jsonb, <span class="hljs-meta hljs-path hljs-rust"><span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">pg<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>Pg<span class="hljs-punctuation hljs-definition hljs-generic hljs-end hljs-rust">&gt;</span></span> <span class="hljs-keyword hljs-other hljs-rust">for</span></span><span class="hljs-meta hljs-impl hljs-rust"> <span class="hljs-variable hljs-other hljs-rust">$type</span> </span><span class="hljs-meta hljs-impl hljs-rust"><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-begin hljs-rust">{</span>
            <span class="hljs-meta hljs-function hljs-rust"><span class="hljs-meta hljs-function hljs-rust"><span class="hljs-storage hljs-type hljs-function hljs-rust">fn</span> </span><span class="hljs-entity hljs-name hljs-function hljs-rust">to_sql</span></span><span class="hljs-meta hljs-function hljs-rust"><span class="hljs-meta hljs-function hljs-parameters hljs-rust"><span class="hljs-punctuation hljs-section hljs-parameters hljs-begin hljs-rust">(</span>
                <span class="hljs-keyword hljs-operator hljs-rust">&amp;</span><span class="hljs-variable hljs-parameter hljs-rust">self</span>,
                <span class="hljs-variable hljs-parameter hljs-rust">out</span><span class="hljs-punctuation hljs-separator hljs-rust">:</span> <span class="hljs-keyword hljs-operator hljs-rust">&amp;</span><span class="hljs-storage hljs-modifier hljs-rust">mut</span> <span class="hljs-meta hljs-path hljs-rust"><span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">serialize<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-generic hljs-rust">Output<span class="hljs-punctuation hljs-definition hljs-generic hljs-begin hljs-rust">&lt;</span><span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">pg<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>Pg<span class="hljs-punctuation hljs-definition hljs-generic hljs-end hljs-rust">&gt;</span></span>,
            </span><span class="hljs-meta hljs-function hljs-rust"><span class="hljs-meta hljs-function hljs-parameters hljs-rust"><span class="hljs-punctuation hljs-section hljs-parameters hljs-end hljs-rust">)</span></span></span></span><span class="hljs-meta hljs-function hljs-rust"> <span class="hljs-meta hljs-function hljs-return-type hljs-rust"><span class="hljs-punctuation hljs-separator hljs-rust">-&gt;</span> <span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">serialize<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>Result</span> </span><span class="hljs-meta hljs-function hljs-rust"><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-begin hljs-rust">{</span>
                <span class="hljs-keyword hljs-other hljs-rust">use</span> <span class="hljs-meta hljs-path hljs-rust">std<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">io<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>Write<span class="hljs-punctuation hljs-terminator hljs-rust">;</span>

                out.<span class="hljs-support hljs-function hljs-rust">write_all</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span><span class="hljs-keyword hljs-operator hljs-rust">&amp;</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">[</span><span class="hljs-constant hljs-numeric hljs-integer hljs-decimal hljs-rust">1</span><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">]</span></span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span><span class="hljs-keyword hljs-operator hljs-rust">?</span><span class="hljs-punctuation hljs-terminator hljs-rust">;</span>
                <span class="hljs-meta hljs-path hljs-rust">serde_json<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>to_writer<span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span>out<span class="hljs-punctuation hljs-separator hljs-rust">,</span> <span class="hljs-variable hljs-language hljs-rust">self</span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span>
                    .<span class="hljs-support hljs-function hljs-rust">map</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span><span class="hljs-meta hljs-function hljs-closure hljs-rust"><span class="hljs-meta hljs-function hljs-parameters hljs-rust"><span class="hljs-punctuation hljs-section hljs-parameters hljs-begin hljs-rust">|</span></span></span><span class="hljs-meta hljs-function hljs-closure hljs-rust"><span class="hljs-meta hljs-function hljs-parameters hljs-rust">_<span class="hljs-punctuation hljs-section hljs-parameters hljs-end hljs-rust">|</span></span> </span><span class="hljs-meta hljs-function hljs-closure hljs-rust"><span class="hljs-meta hljs-path hljs-rust">diesel<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">serialize<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span><span class="hljs-meta hljs-path hljs-rust">IsNull<span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>No</span></span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span>
                    .<span class="hljs-support hljs-function hljs-rust">map_err</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-begin hljs-rust">(</span><span class="hljs-support hljs-type hljs-rust">Into</span><span class="hljs-meta hljs-path hljs-rust"><span class="hljs-punctuation hljs-accessor hljs-rust">::</span></span>into</span><span class="hljs-meta hljs-group hljs-rust"><span class="hljs-punctuation hljs-section hljs-group hljs-end hljs-rust">)</span></span>
              
                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span> Same as above, using Diesel&#39;s internal serde_json::Value support to do most of the work.
</span>                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span> let value = serde_json::to_value(self)?;
</span>                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span> &lt;serde_json::Value as diesel::serialize::ToSql&lt;
</span>                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span>     diesel::sql_types::Jsonb,
</span>                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span>     diesel::pg::Pg,
</span>                <span class="hljs-comment hljs-line hljs-double-slash hljs-rust"><span class="hljs-punctuation hljs-definition hljs-comment hljs-rust">//</span> &gt;&gt;::to_sql(&amp;value, &amp;mut out.reborrow())
</span>            </span><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-end hljs-rust">}</span></span></span>
        </span><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-end hljs-rust">}</span></span></span>
    <span class="hljs-punctuation hljs-section hljs-block hljs-end hljs-rust">}</span></span>;
</span><span class="hljs-meta hljs-block hljs-rust"><span class="hljs-punctuation hljs-section hljs-block hljs-end hljs-rust">}</span></span></span>

</span></code></pre></li>
      </ul>
    </li>
  </ul>


