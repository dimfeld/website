---
title: "Huggingface Transformers"
tags: 
date: 2023-05-14
updated: 2023-05-15
---


  <ul class="list-bullet">
    <li><span><span class="font-medium text-gray-800">source:</span> <span><a href="https://huggingface.co/learn/nlp-course/chapter0/1?fw=pt">https://huggingface.co/learn/nlp-course/chapter0/1?fw=pt</a></span></span></li>
    <li><h1>Pipelines</h1>
      <ul class="list-bullet">
        <li><pre><code><span class="sy-source sy-python"><span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-from sy-python">from</span></span><span class="sy-meta sy-statement sy-import sy-python"><span class="sy-meta sy-import-source sy-python"> <span class="sy-meta sy-import-path sy-python"><span class="sy-meta sy-import-name sy-python">transformers</span></span> <span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-python">import</span></span></span></span><span class="sy-meta sy-statement sy-import sy-python"></span><span class="sy-meta sy-statement sy-import sy-python"> <span class="sy-meta sy-generic-name sy-python">pipeline</span></span>

<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">classifier</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">pipeline</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">sentiment-analysis<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

</span></code></pre></li>
        <li>Full list of premade pipelines: <a href="https://huggingface.co/docs/transformers/main_classes/pipelines">https://huggingface.co/docs/transformers/main_classes/pipelines</a></li>
        <li>Pipelines take a <code>model</code> argument. Some models also specify a particular pipeline to use, and in that case you can omit the pipeline name.</li>
        <li><pre><code><span class="sy-source sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">generator</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">pipeline</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">text-generation<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">model</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">distilgpt2<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
</span></code></pre></li>
        <li>Mask model for filling in words</li>
        <li><pre><code><span class="sy-source sy-python"><span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-from sy-python">from</span></span><span class="sy-meta sy-statement sy-import sy-python"><span class="sy-meta sy-import-source sy-python"> <span class="sy-meta sy-import-path sy-python"><span class="sy-meta sy-import-name sy-python">transformers</span></span> <span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-python">import</span></span></span></span><span class="sy-meta sy-statement sy-import sy-python"></span><span class="sy-meta sy-statement sy-import sy-python"> <span class="sy-meta sy-generic-name sy-python">pipeline</span></span>

<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">unmasker</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">pipeline</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">fill-mask<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
<span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">unmasker</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">This course will teach you all about &lt;mask&gt; models.<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">top_k</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-constant sy-numeric sy-integer sy-decimal sy-python">2</span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

</span></code></pre></li>
        <li><h2>Pipeline Implementation</h2></li>
        <li>Each pipeline is just running the few steps needed to run a model. For example, a BERT sequence classification pipeline may do something like this:
          <ul class="list-bullet">
            <li><pre><code><span class="sy-source sy-python"><span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-from sy-python">from</span></span><span class="sy-meta sy-statement sy-import sy-python"><span class="sy-meta sy-import-source sy-python"> <span class="sy-meta sy-import-path sy-python"><span class="sy-meta sy-import-name sy-python">transformers</span></span> <span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-python">import</span></span></span></span><span class="sy-meta sy-statement sy-import sy-python"></span><span class="sy-meta sy-statement sy-import sy-python"> <span class="sy-meta sy-generic-name sy-python">AutoTokenizer</span><span class="sy-punctuation sy-separator sy-import-list sy-python">,</span> <span class="sy-meta sy-generic-name sy-python">AutoModelForSequenceClassification</span></span>
<span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-python">import</span> <span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">torch</span></span></span>

<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">text_inputs</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-structure sy-list sy-python"><span class="sy-punctuation sy-section sy-list sy-begin sy-python">[</span>
    <span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">I&#39;ve been waiting for a HuggingFace course my whole life.<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span><span class="sy-punctuation sy-separator sy-list sy-python">,</span>
    <span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">I hate this so much!<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span><span class="sy-punctuation sy-separator sy-list sy-python">,</span>
<span class="sy-punctuation sy-section sy-list sy-end sy-python">]</span></span>
<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">checkpoint</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">distilbert-base-uncased-finetuned-sst-2-english<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span>

<span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> Tokenize the input
</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">tokenizer</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">AutoTokenizer</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">from_pretrained</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">checkpoint</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">inputs</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">tokenizer</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">text_inputs</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">padding</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-constant sy-language sy-python">True</span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">truncation</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-constant sy-language sy-python">True</span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">return_tensors</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">pt<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

<span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> Run the model
</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">model</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">AutoModelForSequenceClassification</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">from_pretrained</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">checkpoint</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">outputs</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">model</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-keyword sy-operator sy-arithmetic sy-python">*</span><span class="sy-keyword sy-operator sy-arithmetic sy-python">*</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">inputs</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

<span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> Softmax to convert from logits to probabilities
</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">predictions</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">torch</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span><span class="sy-meta sy-generic-name sy-python">nn</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span><span class="sy-meta sy-generic-name sy-python">functional</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">softmax</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">outputs</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span><span class="sy-meta sy-generic-name sy-python">logits</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">dim</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-keyword sy-operator sy-arithmetic sy-python">-</span><span class="sy-constant sy-numeric sy-integer sy-decimal sy-python">1</span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
<span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> predictions == tensor([[4.0195e-02, 9.5980e-01],
</span><span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span>        [9.9946e-01, 5.4418e-04]], grad_fn=&lt;SoftmaxBackward&gt;)
</span>
<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">model</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span><span class="sy-meta sy-generic-name sy-python">config</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span><span class="sy-meta sy-generic-name sy-python">id2label</span></span>
<span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> {0: &#39;NEGATIVE&#39;, 1: &#39;POSITIVE&#39;}
</span><span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> So the first input is positive, second input is negative.
</span></span></code></pre></li>
          </ul>        </li>
      </ul>    </li>
    <li><h1>Specific Model Types</h1>
      <ul class="list-bullet">
        <li>In addition to <code>AutoModel</code> the <code>transformers</code> library provides classes for specific model types, such as <code>BertConfig</code> and <code>BertModel</code>. In most inference-only cases <code>AutoModel</code> is fine though.</li>
        <li>When not training a model from scratch, you will usually preload a specific config.</li>
        <li><pre><code><span class="sy-source sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">model</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">BertModel</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">from_pretrained</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">bert-base-cased<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">tokenizer</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">BertTokenizer</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">from_pretrained</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">bert-base-cased<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
</span></code></pre></li>
        <li><code>from_pretrained</code> will also download the weights and related files, if needed.</li>
        <li>When you have performed additional training, you can use <code>model.save_pretrained(filename)</code> to save the config and the weights to disk.</li>
      </ul>    </li>
    <li><h1>Tokenizers</h1>
      <ul class="list-bullet">
        <li>Tokenizers can both go from raw text to token IDs with <code>tokenizer.tokenize</code> and <code>tokenizer.convert_tokens_to_ids</code>, and back from token IDs to words again with <code>tokenizer.decode</code>, which will both convert IDs to tokens and combine subword tokens into full words.</li>
        <li>The padding token ID can be retrieved from <code>tokenizer.pad_token_id</code>.</li>
        <li>Attention masks can be used to tell the model to ignore certain tokens. This usually matches to the locations of the padding tokens being <code>0</code> and everything else being <code>1</code>.</li>
        <li><pre><code><span class="sy-source sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">ids</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">torch</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">tensor</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-structure sy-list sy-python"><span class="sy-punctuation sy-section sy-list sy-begin sy-python">[</span><span class="sy-constant sy-language sy-python">...</span><span class="sy-punctuation sy-section sy-list sy-end sy-python">]</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">attention_mask</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">torch</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">tensor</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-structure sy-list sy-python"><span class="sy-punctuation sy-section sy-list sy-begin sy-python">[</span><span class="sy-constant sy-language sy-python">...</span><span class="sy-punctuation sy-section sy-list sy-end sy-python">]</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">outputs</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">model</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">ids</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">attention_mask</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">attention_mask</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
</span></code></pre></li>
        <li>Depending on the tensor framework in use, you can ask the tokenizer for different types of tensors.</li>
        <li><pre><code><span class="sy-source sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">inputs</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">tokenizer</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">texts</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">return_tensor</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">pt<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span> <span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> PyTorch
</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">inputs</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">tokenizer</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">texts</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">return_tensor</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">tf<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span> <span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> TensorFlow
</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">inputs</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">tokenizer</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">texts</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">return_tensor</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">np<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span> <span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> NumPy
</span></span></code></pre></li>
        <li>Tokenizers support all the standard configuration
          <ul class="list-bullet">
            <li><code>truncation=True</code> to truncate inputs longer than model context. <code>max_length=16</code> to use a custom truncation length</li>
            <li><code>padding=True</code> to pad inputs to the same length</li>
          </ul>        </li>
      </ul>    </li>
    <li><h1>Training</h1>
      <ul class="list-bullet">
        <li>To train a model, you tokenize your inputs and then add an additional <code>labels</code> property which is a tensor with the expected answer for each one.</li>
        <li><pre><code><span class="sy-source sy-python"><span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-python">import</span> <span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">torch</span></span></span>
<span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-from sy-python">from</span></span><span class="sy-meta sy-statement sy-import sy-python"><span class="sy-meta sy-import-source sy-python"> <span class="sy-meta sy-import-path sy-python"><span class="sy-meta sy-import-name sy-python">transformers</span></span> <span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-python">import</span></span></span></span><span class="sy-meta sy-statement sy-import sy-python"></span><span class="sy-meta sy-statement sy-import sy-python"> <span class="sy-meta sy-generic-name sy-python">AdamW</span><span class="sy-punctuation sy-separator sy-import-list sy-python">,</span> <span class="sy-meta sy-generic-name sy-python">AutoTokenizer</span><span class="sy-punctuation sy-separator sy-import-list sy-python">,</span> <span class="sy-meta sy-generic-name sy-python">AutoModelForSequenceClassification</span></span>

<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">checkpoint</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">bert-base-uncased<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span>
<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">tokenizer</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">AutoTokenizer</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">from_pretrained</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">checkpoint</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">model</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">AutoModelForSequenceClassification</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">checkpoint</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">sequences</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-structure sy-list sy-python"><span class="sy-punctuation sy-section sy-list sy-begin sy-python">[</span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">string1<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span><span class="sy-punctuation sy-separator sy-list sy-python">,</span> <span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">string2<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span><span class="sy-punctuation sy-separator sy-list sy-python">,</span> <span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">etc<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span><span class="sy-punctuation sy-section sy-list sy-end sy-python">]</span></span>
<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">batch</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">tokenizer</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">sequences</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">padding</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-constant sy-language sy-python">True</span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">truncation</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-constant sy-language sy-python">True</span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">return_tensors</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">pt<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

<span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> The answers for each of the above
</span><span class="sy-meta sy-item-access sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">batch</span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-begin sy-python">[</span></span><span class="sy-meta sy-item-access sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">labels<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-end sy-python">]</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">torch</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">tensor</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-structure sy-list sy-python"><span class="sy-punctuation sy-section sy-list sy-begin sy-python">[</span><span class="sy-constant sy-numeric sy-integer sy-decimal sy-python">1</span><span class="sy-punctuation sy-separator sy-list sy-python">,</span> <span class="sy-constant sy-numeric sy-integer sy-decimal sy-python">0</span><span class="sy-punctuation sy-separator sy-list sy-python">,</span> <span class="sy-constant sy-numeric sy-integer sy-decimal sy-python">1</span><span class="sy-punctuation sy-section sy-list sy-end sy-python">]</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

<span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> Single step, usually a whole training loop would go here.
</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">optimizer</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">AdamW</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">model</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">parameters</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">loss</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">model</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-keyword sy-operator sy-arithmetic sy-python">*</span><span class="sy-keyword sy-operator sy-arithmetic sy-python">*</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">batch</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span><span class="sy-meta sy-generic-name sy-python">loss</span>
<span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">loss</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">backward</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
<span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">optimizer</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">step</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
</span></code></pre></li>
        <li>Because <code>bert-base-uncased</code> is not originally set up for sequence classification, the library will discard the original model head and add a new randomly-weighted head for sequence classification.</li>
        <li>The <code>datasets</code> library automatically splits a dataset into training, validation, and test sets.</li>
        <li><code>dataset.features</code> describes the feature names and types, including (when applicable) the descriptions of what each label number actually means</li>
        <li>You can use <code>dataset.map</code> to tokenize while keeping all the data in the much more efficient Apache Arrow format. It also does multiprocessing and caches results.
          <ul class="list-bullet">
            <li>e.g. for a BERT next-sentence prediction:</li>
            <li><pre><code><span class="sy-source sy-python"><span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-from sy-python">from</span></span><span class="sy-meta sy-statement sy-import sy-python"><span class="sy-meta sy-import-source sy-python"> <span class="sy-meta sy-import-path sy-python"><span class="sy-meta sy-import-name sy-python">transformers</span></span> <span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-python">import</span></span></span></span><span class="sy-meta sy-statement sy-import sy-python"></span><span class="sy-meta sy-statement sy-import sy-python"> <span class="sy-meta sy-generic-name sy-python">DataCollatorWithPadding</span></span>

<span class="sy-meta sy-function sy-python"><span class="sy-storage sy-type sy-function sy-python">def</span> <span class="sy-entity sy-name sy-function sy-python"><span class="sy-meta sy-generic-name sy-python">tokenize</span></span></span><span class="sy-meta sy-function sy-parameters sy-python"><span class="sy-punctuation sy-section sy-parameters sy-begin sy-python">(</span></span><span class="sy-meta sy-function sy-parameters sy-python"><span class="sy-variable sy-parameter sy-python">row</span><span class="sy-punctuation sy-section sy-parameters sy-end sy-python">)</span></span><span class="sy-meta sy-function sy-python"><span class="sy-punctuation sy-section sy-function sy-begin sy-python">:</span></span>
  <span class="sy-keyword sy-control sy-flow sy-return sy-python">return</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">tokenizer</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-item-access sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">row</span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-begin sy-python">[</span></span><span class="sy-meta sy-item-access sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">sentence1<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-end sy-python">]</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-meta sy-item-access sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">row</span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-begin sy-python">[</span></span><span class="sy-meta sy-item-access sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">sentence2<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-end sy-python">]</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">truncation</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-constant sy-language sy-python">True</span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">tokenized</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">dataset</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">map</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">tokenize</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">batched</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-constant sy-language sy-python">True</span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

<span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> Using the collator to pad this way per batch is more efficient than padding everything to the max length across all items
</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">collator</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">DataCollatorWithPadding</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-variable sy-parameter sy-python">tokenizer</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">tokenizer</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">batch_size</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-constant sy-numeric sy-integer sy-decimal sy-python">512</span>
<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">samples</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">collator</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-item-access sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">tokenized</span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-begin sy-python">[</span></span><span class="sy-meta sy-item-access sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">train<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-end sy-python">]</span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-begin sy-python">[</span></span><span class="sy-meta sy-item-access sy-arguments sy-python"><span class="sy-punctuation sy-separator sy-slice sy-python">:</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">batch_size</span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-end sy-python">]</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
</span></code></pre></li>
          </ul>        </li>
        <li>With that set up, you can start your training loop using the <code>Trainer</code> class, which handles all the batching, gradient descent, etc.</li>
        <li><pre><code><span class="sy-source sy-python"><span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-from sy-python">from</span></span><span class="sy-meta sy-statement sy-import sy-python"><span class="sy-meta sy-import-source sy-python"> <span class="sy-meta sy-import-path sy-python"><span class="sy-meta sy-import-name sy-python">transformers</span></span> <span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-python">import</span></span></span></span><span class="sy-meta sy-statement sy-import sy-python"></span><span class="sy-meta sy-statement sy-import sy-python"> <span class="sy-meta sy-generic-name sy-python">TrainingArguments</span><span class="sy-punctuation sy-separator sy-import-list sy-python">,</span> <span class="sy-meta sy-generic-name sy-python">Trainer</span><span class="sy-punctuation sy-separator sy-import-list sy-python">,</span> <span class="sy-meta sy-generic-name sy-python">AutoModelForSequenceClassification</span></span>
<span class="sy-meta sy-statement sy-import sy-python"><span class="sy-keyword sy-control sy-import sy-python">import</span> <span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">evaluate</span></span></span>
<span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> Can also pass `push_to_hub=True` to automatically push to Huggingface Hub when done
</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">training_args</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">TrainingArguments</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">directory-to-save-to<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">evaluation_strategy</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">epoch<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">model</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">AutoModelForSequenceClassification</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">from_pretrained</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">checkpoint</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">num_labels</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-constant sy-numeric sy-integer sy-decimal sy-python">2</span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

<span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> A function to report metrics at the end of each `evaluation_strategy` from the TrainingArguments
</span><span class="sy-meta sy-function sy-python"><span class="sy-storage sy-type sy-function sy-python">def</span> <span class="sy-entity sy-name sy-function sy-python"><span class="sy-meta sy-generic-name sy-python">compute_metrics</span></span></span><span class="sy-meta sy-function sy-parameters sy-python"><span class="sy-punctuation sy-section sy-parameters sy-begin sy-python">(</span></span><span class="sy-meta sy-function sy-parameters sy-python"><span class="sy-variable sy-parameter sy-python">eval_preds</span><span class="sy-punctuation sy-section sy-parameters sy-end sy-python">)</span></span><span class="sy-meta sy-function sy-python"><span class="sy-punctuation sy-section sy-function sy-begin sy-python">:</span></span>
	<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">metric</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">evaluate</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">load</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">same</span></span> <span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">arguments</span></span> <span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">that</span></span> <span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">loaded</span></span> <span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">the</span></span> <span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">dataset</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
    <span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">logits</span></span>, <span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">labels</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">eval_preds</span></span>
    <span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">predictions</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">np</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">argmax</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">logits</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">axis</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-keyword sy-operator sy-arithmetic sy-python">-</span><span class="sy-constant sy-numeric sy-integer sy-decimal sy-python">1</span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
    <span class="sy-keyword sy-control sy-flow sy-return sy-python">return</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">metric</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">compute</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-variable sy-parameter sy-python">predictions</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">predictions</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span> <span class="sy-variable sy-parameter sy-python">references</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">labels</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">trainer</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">Trainer</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python">
	<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">model</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span>
	<span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">training_args</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span>
	<span class="sy-variable sy-parameter sy-python">train_dataset</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-item-access sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">tokenized</span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-begin sy-python">[</span></span><span class="sy-meta sy-item-access sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">train<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-end sy-python">]</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span>
	<span class="sy-variable sy-parameter sy-python">eval_dataset</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-item-access sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">tokenized</span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-begin sy-python">[</span></span><span class="sy-meta sy-item-access sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">validation<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-end sy-python">]</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span>
  	<span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> This can be skipped if using a DataCollatorWithPadding since that&#39;s the default when omitted.
</span>	<span class="sy-variable sy-parameter sy-python">data_collator</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">collator</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span>
	<span class="sy-variable sy-parameter sy-python">tokenizer</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">tokenizer</span></span><span class="sy-punctuation sy-separator sy-arguments sy-python">,</span>
  	<span class="sy-variable sy-parameter sy-python">compute_metrics</span><span class="sy-keyword sy-operator sy-assignment sy-python">=</span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">compute_metrics</span></span>
</span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>

<span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">trainer</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">train</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
</span></code></pre></li>
        <li>Full training loop example at <a href="https://huggingface.co/learn/nlp-course/chapter3/4?fw=pt">https://huggingface.co/learn/nlp-course/chapter3/4?fw=pt</a></li>
        <li>Once the model has finished training, the Trainer will let you run the model.</li>
        <li><pre><code><span class="sy-source sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">predictions</span></span> <span class="sy-keyword sy-operator sy-assignment sy-python">=</span> <span class="sy-meta sy-function-call sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">trainer</span><span class="sy-punctuation sy-accessor sy-dot sy-python">.</span></span><span class="sy-meta sy-qualified-name sy-python"><span class="sy-variable sy-function sy-python">predict</span></span><span class="sy-punctuation sy-section sy-arguments sy-begin sy-python">(</span><span class="sy-meta sy-function-call sy-arguments sy-python"><span class="sy-meta sy-item-access sy-python"><span class="sy-meta sy-qualified-name sy-python"><span class="sy-meta sy-generic-name sy-python">tokenized</span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-begin sy-python">[</span></span><span class="sy-meta sy-item-access sy-arguments sy-python"><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python"><span class="sy-punctuation sy-definition sy-string sy-begin sy-python">&quot;</span></span></span><span class="sy-meta sy-string sy-python"><span class="sy-string sy-quoted sy-double sy-python">validation<span class="sy-punctuation sy-definition sy-string sy-end sy-python">&quot;</span></span></span></span><span class="sy-meta sy-item-access sy-python"><span class="sy-punctuation sy-section sy-brackets sy-end sy-python">]</span></span></span><span class="sy-punctuation sy-section sy-arguments sy-end sy-python">)</span></span>
<span class="sy-comment sy-line sy-number-sign sy-python"><span class="sy-punctuation sy-definition sy-comment sy-python">#</span> { predictions: [predicted logits for each row], label_ids: [correct answers], metrics }
</span></span></code></pre></li>
      </ul>    </li>
  </ul>

