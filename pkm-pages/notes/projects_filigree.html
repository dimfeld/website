---
title: "Filigree"
tags: Projects
date: 2023-12-09
updated: 2024-07-04
---


  <ul class="list-bullet">
    <li>Filigree is a web app framework based on Rust with <a href="https://kit.svelte.dev">SvelteKit</a> or <a href="https://htmx.org">Htmx</a>, which includes common components such as authentication and background workers, and also makes it easier to set up data models and generate SQL, endpoints, and so on to use them.</li>
    <li><h2>Task List</h2>
      <ul class="list-bullet">
        <li><h3>Up Next</h3>
          <ul class="list-bullet">
            <li id="660233f8-5485-446f-be9b-291572417c2a"><input type="checkbox" disabled  /> More ergonomic backend object use
              <ul class="list-bullet">
                <li>Have a way to really easily load an object from the DB, modify it, and then save it back to the DB for cases where doing it all in a single SQL statement is a hassle.</li>
                <li>This should probably take the form of methods on the main model struct which internally call the get/update/insert query methods.</li>
                <li>Each object should be able to populate at query time or afterward.</li>
                <li>How much would it work to use SeaORM for this as opposed to use SeaQuery?</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Make it easier for differing get/list model types to be used interchangeably
              <ul class="list-bullet">
                <li>For every structure, add functions that both get one and run a list operation
                  <ul class="list-bullet">
                    <li>This starts to become a lot of SQL files though, what&#39;s a better way to do this? Probably just do this as part of the move to seaquery, and use some OnceLocks for the fixed queries that never change. Mostly have to figure out how best to integrate permissions checks in an easy way here.</li>
                  </ul>                </li>
              </ul>            </li>
          </ul>        </li>
        <li><h3>Soon</h3>
          <ul class="list-bullet">
            <li><input type="checkbox" disabled  /> Evaluate faster API authentication methods between SvelteKit Backend and Rust Backend
              <ul class="list-bullet">
                <li>Basically to make it work better to make multiple API calls from a single request without hitting the database every time to look up the user/roles/etc.</li>
                <li>Instead of just a session ID, have an option to generate a short-lived JWT or similar token that contains all the auth info. Store the JWT in the cookie, on each request check the expiration time and get a new one if getting close to expiring.</li>
                <li>Might also need some hook for client-side requests that can do the renewal if they talk directly to the API.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Simplify permissions system when using custom auth
              <ul class="list-bullet">
                <li>Since we aren&#39;t creating the roles and users, we need a way to make sure that people have reasonable permissions when they start.</li>
                <li>Perhaps just a function that adds default permissions or something like that when we first see a user.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Use docker compose with separate containers for API and SvelteKit parts</li>
            <li><input type="checkbox" disabled  /> More flexible configuration
              <ul class="list-bullet">
                <li>Switch from <code>clap</code> to <code>config</code> or something</li>
                <li>Main impetus here is to make it possible to read configuration from ConfigMap-sourced volumes in K8S and similar systems.</li>
              </ul>            </li>
          </ul>        </li>
        <li><h3>Later/Maybe</h3>
          <ul class="list-bullet">
            <li><input type="checkbox" disabled  /> Improve API error printing
              <ul class="list-bullet">
                <li>Some errors use <code>source</code> and error_stack&#39;s default printer ignores it. Should walk the source chain as well. This seems difficult though without using nightly features</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Metrics tracking and alerts
              <ul class="list-bullet">
                <li>Consistently high CPU, RAM usage, etc.</li>
                <li>Might just use a service for this, need to see</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Option to only allow connections from certain IP ranges
              <ul class="list-bullet">
                <li>eg <a href="https://www.cloudflare.com/ips/">https://www.cloudflare.com/ips/</a> when using Cloudflare</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Helpers for retrying requests and other operations
              <ul class="list-bullet">
                <li>rate limit retry-after</li>
                <li>exponential retry with jitter, etc. for regular retryable failures</li>
                <li>ability to not retry for certain errors</li>
                <li>Maybe just fork backon for this?</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> QoL Issues Encountered
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Conflict in src/main.rs on first run
                  <ul class="list-bullet">
                    <li>Maybe detect if this is the first run by looking at absence of .state directory and ask if it&#39;s ok to just replace it</li>
                  </ul>                </li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Add auto-bootstrap option
              <ul class="list-bullet">
                <li>When appropriate environment variables are set, allows the API to do the bootstrapping itself when it first starts up</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Ops helpers
              <ul class="list-bullet">
                <li>This isn&#39;t part of the core framework, but a set of tools for automatically doing ops-related tasks.</li>
                <li><input type="checkbox" disabled  /> Back up database to cloud storage on a regular basis</li>
                <li><input type="checkbox" disabled  /> Deploy on Git push</li>
                <li><input type="checkbox" disabled  /> Preview environments?</li>
                <li><input type="checkbox" disabled  /> Set up Postgres slow statement tracking and create a report on what was slow</li>
                <li><input type="checkbox" disabled  /> Drop partitions of old data</li>
              </ul>            </li>
            <li>Frontend
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> SvelteKit: Error page</li>
                <li><input type="checkbox" disabled  /> Add dependencies to package.json like we do for the Rust side</li>
                <li><input type="checkbox" disabled  /> App shell with nav bar, etc.</li>
                <li><input type="checkbox" disabled  /> Password reset page</li>
                <li><input type="checkbox" disabled  /> Profile management page</li>
                <li><input type="checkbox" disabled  /> Manage your organization</li>
                <li><input type="checkbox" disabled  /> Default Model editor page</li>
                <li><input type="checkbox" disabled  /> Default Model list page</li>
                <li><input type="checkbox" disabled  /> Admin: invite users to app</li>
                <li><input type="checkbox" disabled  /> Admin: administer organizations</li>
                <li><input type="checkbox" disabled  /> 404 page</li>
                <li><input type="checkbox" disabled  /> TS Type Enhancements
                  <ul class="list-bullet">
                    <li><input type="checkbox" disabled  /> Permission names per model</li>
                  </ul>                </li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> HTMX support improvements
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Debugging option to show a toast whenever a livereload finishes or an htmx error occurs</li>
                <li><input type="checkbox" disabled  /> move client-side code from SBBP into Filigree for reuse by other projects</li>
                <li><input type="checkbox" disabled  /> theming, dark/light mode with persistence via localStorage and header script to inject dark class
                  <ul class="list-bullet">
                    <li>DaisyUI provides a lot of this already</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Island architecture support for Svelte components
                  <ul class="list-bullet">
                    <li>Each of these should be its own entry point in the Vite config, and from there we can use the manifest support to get the necessary tags</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Flash/toast support
                  <ul class="list-bullet">
                    <li>Can probably be done with HX-Trigger header, or maybe an extension</li>
                    <li><input type="checkbox" disabled  /> Adapter function for actions to have errors return a toast</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Implement fancy dropdown menu in Alpine with floating-ui
                  <ul class="list-bullet">
                    <li><a href="https://github.com/awcodes/alpine-floating-ui">https://github.com/awcodes/alpine-floating-ui</a> may work well</li>
                    <li><a href="https://alpinejs.dev/plugins/anchor">https://alpinejs.dev/plugins/anchor</a> is the official one, seems to support fewer options</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Improve livereload performance
                  <ul class="list-bullet">
                    <li>Not sure how much opportunity there is here but it feels like it can be made 20% faster</li>
                    <li>Dioxus is working on <a href="https://twitter.com/dioxuslabs/status/1797206374960476530">a solution</a> that I should be able to adapt once it&#39;s public.</li>
                  </ul>                </li>
              </ul>            </li>
            <li>Models Backend
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Joining tables
                  <ul class="list-bullet">
                    <li>Doesn&#39;t compile yet. Configuration and SQL migrations are done here, need the rest of the support:</li>
                    <li><input type="checkbox" disabled  /> Handle <code>through</code> relationships in fetch queries</li>
                    <li><input type="checkbox" disabled  /> Updates in main payload for <code>through</code> relationships
                      <ul class="list-bullet">
                        <li>This will just be IDs on the other side. Write payload field name should just be <code>OTHER_SIDE_NAME_ids</code></li>
                      </ul>                    </li>
                    <li><input type="checkbox" disabled  /> Generate endpoints for managing links in joining tables
                      <ul class="list-bullet">
                        <li>These can just be CRUD endpoints on the linking model. Main difference is the URL structure accounts for the composite ID</li>
                      </ul>                    </li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> tests for list endpoint filtering/pagination/sorting</li>
                <li><input type="checkbox" disabled  /> Generate endpoints for grandchild objects
                  <ul class="list-bullet">
                    <li>Probably need to make this generally recursive which may difficult to do via the current template system, might need a macro that can call itself or some fancier fragment rendering.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Models with non-writable, but required, fields don&#39;t generate valid tests
                  <ul class="list-bullet">
                    <li>This can happen when the normal &quot;create&quot; workflow happens in some other way than calling a REST create endpoint.</li>
                    <li>Will be easier to fix once <a class="block-ref" href="/notes/projects_filigree#660233f8-5485-446f-be9b-291572417c2a"><input type="checkbox" disabled  /> More ergonomic backend object use</a> is done</li>
                    <li>Also consider detecting this and just not generating an &quot;insert&quot; script that can&#39;t work.
                      <ul class="list-bullet">
                        <li>The criteria is a model that has at least one field which
                          <ul class="list-bullet">
                            <li>is not <code>fixed</code></li>
                            <li>is not <code>nullable</code></li>
                            <li>has no default (SQL or Rust)</li>
                            <li>is not writable by owner</li>
                          </ul>                        </li>
                      </ul>                    </li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Support file uploads in multipart form submissions
                  <ul class="list-bullet">
                    <li>A lot of the underlying framework for this is ready but the code itself needs to be written. Main issue is that the current <code>FormOrJson</code> can&#39;t be used in that case. Instead we probably need something that even on a JSON file looks like a multipart submission, but just doesn&#39;t return any files.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Test populated get and list when update<em class="italic">with</em>parent is false</li>
                <li><input type="checkbox" disabled  /> Models can define extra permissions</li>
                <li><input type="checkbox" disabled  /> Allow disabling child population at runtime in list/get endpoints, when it is enabled by default
                  <ul class="list-bullet">
                    <li>This is one place it would help to use sea_query</li>
                  </ul>                </li>
              </ul>            </li>
            <li>CLI / Template System
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Bug: CLI doesn&#39;t throw an error if a field is defined twice</li>
                <li><input type="checkbox" disabled  /> Use <a href="https://lib.rs/crates/toml_edit">toml_edit</a> to allow adding features to Cargo.toml</li>
                <li><input type="checkbox" disabled  /> When generating migrations, read in the actual app migrations and ignore tables that we don&#39;t care about.
                  <ul class="list-bullet">
                    <li>This lets us see things like model tables having been removed if, say, a migration file was deleted since it did the wrong thing.</li>
                    <li>Do need to figure out how to handle extra columns added in the model via manual SQL migrations here.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Command to print config and diff files against last gen and current config gen</li>
                <li><input type="checkbox" disabled  /> Consider using something like sea_query to generate queries instead of a bunch of fixed queries
                  <ul class="list-bullet">
                    <li>Will add flexibility, and could make a lot of things simpler. Need to see if there&#39;s still a good way to pre-generate queries when running the CLI</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Data-driven default org contents, even if just a JSON blob to start
                  <ul class="list-bullet">
                    <li>This can piggyback off of the fixture system</li>
                    <li>Considering not doing this since it may be simpler to just do it in a function.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Some way to easily add hooks to CRUD operations
                  <ul class="list-bullet">
                    <li>Developer should probably just edit the generated code here.</li>
                    <li>Maybe add stub functions to each model to allow adding pre/post save hooks</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Make it easy for additional queries to use the permissions macros
                  <ul class="list-bullet">
                    <li>Probably moving away from SQL and toward Rust code for permissions checks so this won&#39;t matter as much</li>
                    <li>Can suggest using sqlweld here</li>
                    <li>See if there&#39;s a path to using a query builder like <code>sea_query</code> instead, maybe as an addition to the existing thing.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Autogenerate belongs_to field if necessary when the inverse has is detected without a through table.
                  <ul class="list-bullet">
                    <li>Currently this returns an error instead</li>
                  </ul>                </li>
              </ul>            </li>
            <li>Authentication and Registration
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Make SessionBackend work with custom auth
                  <ul class="list-bullet">
                    <li>It mostly works but when the tables are in another schema then it doesn&#39;t. Need a less-fixed query method here.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Rate limiting for login-related endpoints
                  <ul class="list-bullet">
                    <li><a href="https://docs.rs/governor/latest/governor/">https://docs.rs/governor/latest/governor/</a></li>
                    <li><a href="https://lib.rs/crates/tower_governor">https://lib.rs/crates/tower_governor</a></li>
                    <li><a href="https://github.com/brandur/redis-cell">https://github.com/brandur/redis-cell</a> if i need this to be distributed
                      <ul class="list-bullet">
                        <li>DragonflyDB is a redis-compatible that has this built-in</li>
                      </ul>                    </li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Passwordless login should include a code that can be pasted into the UI to log in instead.</li>
                <li><input type="checkbox" disabled  /> Password requirements
                  <ul class="list-bullet">
                    <li>length</li>
                    <li>mix of character types</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Prevent reuse of recent passwords</li>
                <li><input type="checkbox" disabled  /> Expire passwords that need a rehash due to upgraded standards</li>
                <li><input type="checkbox" disabled  /> Option to expire passwords after a certain amount of time
                  <ul class="list-bullet">
                    <li>This isn&#39;t recommended practice but some enterprise clients require this in order to sign with you.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Passkeys
                  <ul class="list-bullet">
                    <li><a href="https://passkeys.dev/">https://passkeys.dev/</a></li>
                    <li><a href="https://github.com/1Password/passkey-rs">https://github.com/1Password/passkey-rs</a></li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> RSA timecode Authenticator app</li>
                <li><input type="checkbox" disabled  /> Authenticator Account recovery codes</li>
                <li><input type="checkbox" disabled  /> Account self-deletion</li>
                <li><input type="checkbox" disabled  /> Optional TOS acceptance at registration</li>
                <li><input type="checkbox" disabled  /> Service accounts</li>
                <li><input type="checkbox" disabled  /> Record info about sessions (geoip, user-agent, etc.)</li>
                <li><input type="checkbox" disabled  /> Allow viewing other sessions for your user, and potentially logging them out</li>
                <li><input type="checkbox" disabled  /> Invite users to your team</li>
                <li><input type="checkbox" disabled  /> Invite users to the app, but not in your team</li>
                <li><input type="checkbox" disabled  /> Link a new OAuth login that may not have a matching email to an existing account</li>
                <li><input type="checkbox" disabled  /> When logging in via OAuth, fetch all known emails from the OAuth provider and see if any of them match an existing account if we haven&#39;t seen the account before.
                  <ul class="list-bullet">
                    <li>Need to handle the case where there are multiple emails and they match different accounts. This probably requires an interstitial after the login page to select the matching account.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Waitlist functionality</li>
                <li><input type="checkbox" disabled  /> Put auth code behind an adapter so it can be swapped out for a 3rd-party service</li>
              </ul>            </li>
            <li>Permissions and Authorization
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> <a class="block-ref" href="/notes/projects_filigree#657a981d-8503-427b-a6ab-319c7879b94c">Project-based Access Control</a></li>
                <li><input type="checkbox" disabled  /> Consider separating permissions checks from the SQL queries themselves
                  <ul class="list-bullet">
                    <li>This has the upside that it would simplify a lot of checking for permissions and make more complex permissions easier</li>
                    <li>Upsides
                      <ul class="list-bullet">
                        <li>SQL templates become simpler</li>
                        <li>Much easier to implement ABAC</li>
                        <li>Easier to differentiate authz errors from missing objects</li>
                      </ul>                    </li>
                    <li>Downsides
                      <ul class="list-bullet">
                        <li>Requires remembering to actually check for permissions, though that&#39;s alleviated some by the template system since the checks can be placed in the access functions.</li>
                        <li>We also end up reading objects multiple times in update/delete situations, though this isn&#39;t that big of a deal. For project-based permissions we could potentially load all the projects though would have to see about that.</li>
                      </ul>                    </li>
                    <li>Should probably do this as permissions is becoming more and more complex as more options are added.</li>
                    <li>Maybe consider something like casbin or biscuits too. Feels like overkill at this point for most things though, probably more appropriate for an API-first product.</li>
                    <li>list query would still need permissions checks in the SQL</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> API Key lookup query needs to change to make permissions a subset of the user&#39;s permissions when inherit<em class="italic">user</em>permissions is false
                  <ul class="list-bullet">
                    <li>This way if a user has some permissions removed, they can&#39;t bypass those limits using an old API key which still had those permissions</li>
                    <li>This is actually a good use case for casbin or biscuit, though could still be implemented without it.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Feature flags</li>
                <li><input type="checkbox" disabled  /> Add &quot;all&quot; model permissions so that some roles have permissions on everything even when new models are added.
                  <ul class="list-bullet">
                    <li>This needs some more thought though. Some models like user, org, etc don&#39;t want to have this blanket rule applied. Might be better to just do this via migrations.</li>
                    <li>Better: Have some models use global org-wide permissions of just &quot;read,&quot; &quot;write,&quot; etc. and only specific models have their own set of permissions.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Ability to apply limits on how many objects are created
                  <ul class="list-bullet">
                    <li>There&#39;s a lot of flexibility here, since the limits could be something simple like number of objects, or some derived metric such as &quot;number of minutes&quot; for an audio-based model.</li>
                    <li>The source for the limits could also come from a number of different places, most commonly pricing plan but could be other stuff such as number of community contributions, upvotes, etc.</li>
                    <li>So the question is what&#39;s the proper framework to make it easy to write code that accomplishes all this.
                      <ul class="list-bullet">
                        <li>Make it easy to fetch the limits data.</li>
                        <li>Make it easy to enforce rules around these limits.</li>
                      </ul>                    </li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> API call quotas
                  <ul class="list-bullet">
                    <li>e.g. 3000 calls per month, 20  calls per hour</li>
                    <li>This should be able to group endpoints by categories where they all share a quota</li>
                    <li id="65b71168-ac29-47fc-b3f5-6913e2ea63c2">Might need to do this with a combination of event tracking and a rate limiter</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Usage-based pricing</li>
                <li><input type="checkbox" disabled  /> Ability to add rate limiting on any endpoint
                  <ul class="list-bullet">
                    <li>keyed by org</li>
                    <li>keyed by user</li>
                    <li>endpoints can share a bucket</li>
                    <li>Local tracking is fine at first, should eventually support doing it in Redis or similar to support multiple API servers.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Ability for admins to assume permissions of other users
                  <ul class="list-bullet">
                    <li>This needs to be audited as well even if nothing else is audited</li>
                  </ul>                </li>
              </ul>            </li>
            <li>Workers
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Ability to run worker tasks in some other process/VM/FaaS
                  <ul class="list-bullet">
                    <li>Need to figure out configuration for this... this might be better implemented in the task queue itself</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Outbox pattern support for transactional starting of background jobs
                  <ul class="list-bullet">
                    <li>Not important for now since <a href="/notes/projects_effectum">Effectum</a> only runs in-process but at some point it will have a server mode and then it will make more sense.</li>
                  </ul>                </li>
              </ul>            </li>
            <li>Block Storage and File Uploads
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Option for Uploads via signed URL</li>
                <li><input type="checkbox" disabled  /> Generate tests for file upload endpoints</li>
                <li><input type="checkbox" disabled  /> When retain<em class="italic">file</em>on_delete is set, optionally add an entry to a table that lists orphaned files.
                  <ul class="list-bullet">
                    <li>The idea being that we might want to hold on to orphaned files for some period of time, and then delete them later.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Image statistics on upload
                  <ul class="list-bullet">
                    <li>format, width, height
                      <ul class="list-bullet">
                        <li>Can detect on upload using code from <a href="/notes/projects_pic_store">Pic Store</a></li>
                      </ul>                    </li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  />  Generate image thumbnail and blurhash
                  <ul class="list-bullet">
                    <li>Best done in background worker</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Potentially need a way to upload a file before the parent object exists. Will probably wait for a real use case on this one.
                  <ul class="list-bullet">
                    <li>Could make the parent ID nullable here and then add an endpoint to &quot;claim&quot; a file for a particular parent object</li>
                    <li>Also could just do the Github style thing and upload them to a publicly available bucket. We don&#39;t maintain a file database entry  in this case, and just return the public URL for whatever use it is.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Allow specifying storage provider presets from env vars, not just in config</li>
              </ul>            </li>
            <li>Notifications
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Notifications: Other types of notifications?</li>
                <li><input type="checkbox" disabled  /> Notifications Internal notifications
                  <ul class="list-bullet">
                    <li>e.g. Discord webhook notifying myself about events</li>
                    <li>This should have notification templates and also destinations for the notifications</li>
                  </ul>                </li>
              </ul>            </li>
            <li>Workflow System
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Build the workflow system
                  <ul class="list-bullet">
                    <li>A lot from <a href="/notes/projects_ergo">Ergo</a> can be reused</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> State chart implementation</li>
                <li><input type="checkbox" disabled  /> Workflows can &quot;sleep&quot; by enqueueing a scheduled task that will continue running when it wakes up</li>
                <li><input type="checkbox" disabled  /> Endpoint to send an event to a workflow</li>
                <li><input type="checkbox" disabled  /> Define workflow actions</li>
                <li><input type="checkbox" disabled  /> Ability to define workflows in the app config</li>
                <li><input type="checkbox" disabled  /> Scripting for Workflows
                  <ul class="list-bullet">
                    <li>Piggyback on Ergo but maybe switch to QuickJS or <a href="https://github.com/saghul/txiki.js">saghul/txiki.js: A tiny JavaScript runtime</a></li>
                  </ul>                </li>
              </ul>            </li>
            <li>Hosting
              <ul class="list-bullet">
                <li>Not sure if I&#39;ll do any of this, it&#39;s really better handled by a reverse proxy</li>
                <li><input type="checkbox" disabled  /> LetsEncrypt support</li>
                <li><input type="checkbox" disabled  /> TLS/HTTPS support</li>
                <li><input type="checkbox" disabled  /> HTTP -&gt; HTTPS redirect</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> User model list/get functions need to return users which are in multiple orgs, and whose current org is a different one</li>
            <li><input type="checkbox" disabled  /> Easy setup for commercialization</li>
            <li><input type="checkbox" disabled  /> Collect and export metrics to some tool
              <ul class="list-bullet">
                <li>Looks like Honeycomb supports Prometheus format</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Basic Analytics</li>
            <li><input type="checkbox" disabled  /> More complex workflow/funnel analytics</li>
            <li>Data Hooks and Similar
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Delete log table for possibility of undelete later</li>
                <li><input type="checkbox" disabled  /> Option for auditing on all operations</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Password confirmation flow for &quot;dangerous&quot; actions</li>
            <li><input type="checkbox" disabled  /> User profile photos</li>
            <li><input type="checkbox" disabled  /> Copy all tests in test-app into filigree crate where it makes sense
              <ul class="list-bullet">
                <li>Some tests are more convenient to test in the test app, but rely on minimal scaffolded functionality. Should add a minimal server/migration setup in filigree crate tests so that they can run there as well.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Support SQLite
              <ul class="list-bullet">
                <li>Not sure how much work it will be to support both Postgres and SQLite, could turn out to be a big hassle due to differeing feature support and syntax, but I&#39;ll see at some point</li>
              </ul>            </li>
          </ul>        </li>
        <li><h3>Done</h3>
          <ul class="list-bullet">
            <li><input type="checkbox" disabled checked /> Make user/org/role/etc. models optional &mdash; May 26th, 2024</li>
            <li><input type="checkbox" disabled checked /> Allow user/org/role IDs to be strings when using custom auth &mdash; May 26th, 2024</li>
            <li><input type="checkbox" disabled checked /> Add more test apps &mdash; May 24th, 2024
              <ul class="list-bullet">
                <li>Add more as big new features are added</li>
                <li>These should mostly be .gitignored except for the files that filigree doesn&#39;t generate</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Bug: Unique fields need to be unique per org, not globally &mdash; May 23rd, 2024</li>
            <li><input type="checkbox" disabled checked /> Pluggable auth system &mdash; May 22nd, 2024
              <ul class="list-bullet">
                <li>Support talking to some other auth microservice, external service, using JWTs or Biscuits, etc.</li>
                <li>This requires
                  <ul class="list-bullet">
                    <li>A new function on the <code>AuthQueries</code> trait that can take a request <code>Parts</code> instead of a pre-parsed API key or session ID
                      <ul class="list-bullet">
                        <li>Or maybe just change the api_key to pass the raw Bearer token, and make it easy to unpack that into an API key for standard uses</li>
                      </ul>                    </li>
                    <li>trait functions should return some error type other than an sqlx::Error. An <code>AuthError</code> is probably the way to go or maybe even just start using <code>Report</code> there so we can save the internal error</li>
                  </ul>                </li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Interactive bootstrap command &mdash; Apr 26th, 2024</li>
            <li><input type="checkbox" disabled checked /> Command to list all the environment variables that will be read along with their defaults if not provided
              <ul class="list-bullet">
                <li>Might be a bit complex but worth it since there can be a lot</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Bug: when deleting a model the files under <code>src/model/NAME/</code> are not removed.
              <ul class="list-bullet">
                <li>Probably need to read the <code>.state</code> directory to see what files we generated before but aren&#39;t being generated this time</li>
                <li>Also don&#39;t delete files which have been edited</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Anonymous user mode
              <ul class="list-bullet">
                <li>Anonymous users get a default Authed with a specific org and user ID created just for the anonymous user.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Allow specifying a user ID for anonymous users to impersonate. This lets them have specific permissions, see certain objects, etc. &mdash; Apr 16th, 2024</li>
            <li><input type="checkbox" disabled checked /> Add <code>init</code> command that runs Cargo init, create-svelte, and creates basic config.toml? &mdash; Apr 16th, 2024</li>
            <li><input type="checkbox" disabled checked /> Add a command that creates a new Postgres user, password, and database for your project &mdash; Apr 16th, 2024</li>
            <li><input type="checkbox" disabled checked /> Support maud/htmx as a SvelteKit alternative for less complicated apps &mdash; Apr 16th, 2024</li>
            <li><input type="checkbox" disabled checked /> Switch out deprecated Jaeger tracing crate for opentelemetry-otlp &mdash; Apr 15th, 2024</li>
            <li><input type="checkbox" disabled checked /> When a type and its populated type are the same, don&#39;t generate e.g &quot;ListAndPopulatedListResult&quot;, just &quot;ListResult&quot; &mdash; Apr 15th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: manifest alterations need to be a vite plugin so they work in dev mode &mdash; Apr 12th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: live reload &mdash; Apr 12th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: asset pipeline config to bundle CSS and scripts, compress assets, etc. &mdash; Apr 11th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: build JS with vite or esbuild, read from file manifest to get list of static files with hash &mdash; Apr 11th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: Simple bundling with vite &mdash; Apr 11th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: Read vite manifest to support hashed values &mdash; Apr 11th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: Instantiate manifest object in app, set up watcher in dev mode  &mdash; Apr 11th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: obfuscate error middleware should only run on JSON responses (although maybe do HTML obfuscation too)  &mdash; Apr 10th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: Potentially a new extractor that lives alongside FormOrJson that always returns the form  &mdash; Apr 10th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: Customize <code>/</code> route in pages &mdash; Apr 10th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: Tailwind CSS support &mdash; Apr 10th, 2024</li>
            <li><input type="checkbox" disabled checked /> Auth failures need to redirect to login page instead of just returning a 404 error -  &mdash; Apr 9th, 2024
              <ul class="list-bullet">
                <li><input type="checkbox" disabled checked /> Errors in general need to do that</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Skip rendering sveltekit files when it is not enabled  &mdash; Apr 8th, 2024</li>
            <li><input type="checkbox" disabled checked /> Remove &quot;sync types&quot; and TS generation code when not using sveltekit  &mdash; Apr 8th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: <code>Page</code> wrapper that gets standard &lt;head&gt; tag contents for all  &mdash; Apr 8th, 2024</li>
            <li><input type="checkbox" disabled checked /> htmx: Allow defining pages and actions  &mdash; Apr 8th, 2024
              <ul class="list-bullet">
                <li>This works similar to the existing endpoints stuff but made for HTML app</li>
                <li>Autogenerate a rust module for each path and its actions</li>
                <li>Should this be in a nested directory structure or just by filenames? Maybe nested directories</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Backend Error reporting &mdash; Apr 7th, 2024
              <ul class="list-bullet">
                <li>Almost done, just need to hook up the error reporting interface into FiligreeServerState so that I can report errors outside of the automatic system.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Frontend error reporting &mdash; Apr 7th, 2024</li>
            <li><input type="checkbox" disabled checked /> Generate JS code to talk to the API
              <ul class="list-bullet">
                <li>This is done for custom endpoint functions, not yet for CRUD</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Add configuration to enable trace export &mdash; Apr 6th, 2024</li>
            <li><input type="checkbox" disabled checked /> Add SQL functions to go between an object ID text and UUID forms. &mdash; Apr 5th, 2024
              <ul class="list-bullet">
                <li>Should have these left over from Ergo</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Frontend: Generate client-side validation &mdash; Apr 5th, 2024
              <ul class="list-bullet">
                <li>This is mostly done with the generated zod schema, but some things are needed such as checking against create or update schema as appropriate</li>
                <li>Right now the UI doesn&#39;t update right on a client-side validation failure</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Set it up to work in production &mdash; Apr 5th, 2024
              <ul class="list-bullet">
                <li><input type="checkbox" disabled checked /> Dockerfile</li>
                <li><input type="checkbox" disabled checked /> handleFetch hook</li>
                <li><input type="checkbox" disabled checked /> Rust side has a fallback route which directs data to the SvelteKit server
                  <ul class="list-bullet">
                    <li>Most uses will also have a reverse proxy in front but this will let it work without that</li>
                  </ul>                </li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Command to print all the environment variables that the generated application will check &mdash; Apr 2nd, 2024</li>
            <li><input type="checkbox" disabled checked /> Specify custom endpoints per model &mdash; Mar 29th, 2024
              <ul class="list-bullet">
                <li>This generates an endpoint function, a route, path/query/body parameters, input/output/query structures, and corresponding Typescript functions and interfaces to use it.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Allow omitting certain normal fields on list &mdash; Mar 27th, 2024
              <ul class="list-bullet">
                <li>e.g. if there&#39;s a large JSON field not needed for the list page we should omit it.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Easy generation of TS types from Rust types &mdash; Mar 25th, 2024</li>
            <li><input type="checkbox" disabled checked /> Background jobs v1 &mdash; Mar 23rd, 2024
              <ul class="list-bullet">
                <li><input type="checkbox" disabled checked /> Define background jobs in config
                  <ul class="list-bullet">
                    <li>Option to set recurrence in config</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> Global and per-job concurrency settings
                  <ul class="list-bullet">
                    <li>Actually do this via multiple worker configurations. Can configure workers equal to your concurrency desires.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> Generate a payload structure for the background job
                  <ul class="list-bullet">
                    <li>No need to define the contents in the config, the user can just fill in what they need</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> Generate a helper to enqueue a background job</li>
                <li><input type="checkbox" disabled checked /> Generate a stub payload and function that runs the job</li>
                <li><input type="checkbox" disabled checked /> Hook it all up
                  <ul class="list-bullet">
                    <li>Add queue to ServerState</li>
                    <li>Make environment variables</li>
                  </ul>                </li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Option to allow setting an object ID when creating an object &mdash; Mar 22nd, 2024
              <ul class="list-bullet">
                <li>This can help with scenarios where we want to create an object and potentially write it to the database later, but have the ID to use beforehand.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Generate Typescript interfaces for models &mdash; Mar 19th, 2024</li>
            <li><input type="checkbox" disabled checked /> Generate tests for child object url endpoints &mdash; Mar 17th, 2024</li>
            <li><input type="checkbox" disabled checked /> File model type &mdash; Mar 15th, 2024
              <ul class="list-bullet">
                <li>Files are a separate model, and when they need to be referenced by another model they can just form a parent-child relationship.</li>
                <li><input type="checkbox" disabled checked /> Add a function for upload
                  <ul class="list-bullet">
                    <li>where should this function go? probably a new file which handles upload, delete, and whatever else might be necessary</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> Add an endpoint to process an upload directly</li>
                <li><input type="checkbox" disabled checked /> Delete file when model is deleted</li>
                <li><input type="checkbox" disabled checked /> Delete files when parent model is deleted</li>
                <li><input type="checkbox" disabled checked /> Special file configuration
                  <ul class="list-bullet">
                    <li>upload path template</li>
                    <li>a bucket from <code>storage.bucket</code> to store an upload</li>
                    <li>permissions for download or not</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> Extra optional fields
                  <ul class="list-bullet">
                    <li>hash</li>
                    <li>file size</li>
                    <li>original filename</li>
                  </ul>                </li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Initial Block Storage Support &mdash; Mar 10th, 2024
              <ul class="list-bullet">
                <li><input type="checkbox" disabled checked /> Block storage abstraction
                  <ul class="list-bullet">
                    <li>use object_store crate for the underlying interface</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> Storage configuration
                  <ul class="list-bullet">
                    <li>The idea here is that each storage location can be configured but the details should be completely configurable at runtime.
                      <ul class="list-bullet">
                        <li>Or should it always be environment based? Probably yes actually except maybe some basics like bucket name, endpoint, etc.</li>
                      </ul>                    </li>
                    <li>something like <code>STORAGE_${location_name}_BUCKET</code> and so on for each provider</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> Use storage configuration in template</li>
                <li><input type="checkbox" disabled checked /> Stream request body into object storage</li>
                <li><input type="checkbox" disabled checked /> Stream multipart files into object storage</li>
                <li><input type="checkbox" disabled checked /> Allow examining data as it streams through</li>
                <li><input type="checkbox" disabled checked /> Stream file from object storage as Response body</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Create endpoints should return children when doing update<em class="italic">with</em>parent &mdash; Feb 29th, 2024</li>
            <li><input type="checkbox" disabled checked /> <del class="line-through">Store .gen files in a tar file instead</del> - Cancelled Feb 28th, 2024
              <ul class="list-bullet">
                <li>This reduces the huge number of files in the state directory, but makes merge conflicts more difficult to deal with.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Parent/child model relationships &mdash; Feb 27th, 2024
              <ul class="list-bullet">
                <li><input type="checkbox" disabled checked /> Configuration</li>
                <li><input type="checkbox" disabled checked /> Add fields for <code>belongs_to</code> relationships to model structures</li>
                <li><input type="checkbox" disabled checked /> Generate composite primary key for joining tables and update queries appropriately</li>
                <li><input type="checkbox" disabled checked /> handle has_one relationships in fetch queries with ID fetch</li>
                <li><input type="checkbox" disabled checked /> handle has_one relationships in fetch queries with data fetch</li>
                <li><input type="checkbox" disabled checked /> handle has_many relationships in fetch queries with ID fetch</li>
                <li><input type="checkbox" disabled checked /> handle has_many relationships in fetch queries with data fetch</li>
                <li><input type="checkbox" disabled checked /> Allow populating <code>references</code> fields on fetch when configured</li>
                <li><input type="checkbox" disabled checked /> Updates for has_one relationships with data payload</li>
                <li><input type="checkbox" disabled checked /> Updates for has_many relationships with data payload</li>
                <li><input type="checkbox" disabled checked /> Generate CRUD endpoints for children of a particular object
                  <ul class="list-bullet">
                    <li>This is basically the same as the normal endpoint, but with the parent ID specified in the URL instead of in the payload.</li>
                    <li>When it&#39;s not a many relationship, omit the child ID parameter</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> Populated query functions
                  <ul class="list-bullet">
                    <li><input type="checkbox" disabled checked /> Call populated functions from endpoints when appropriate</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> SQL Queries for child objects
                  <ul class="list-bullet">
                    <li><input type="checkbox" disabled checked /> List by parent ID
                      <ul class="list-bullet">
                        <li>This could be done as just another filter on the list query instead of a new query template</li>
                      </ul>                    </li>
                    <li><input type="checkbox" disabled checked /> insert/update multiple objects</li>
                    <li><input type="checkbox" disabled checked /> Delete by parent ID where ID is not in the set of IDs just inserted/deleted</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> Ensure that each model is not referenced my more than one non-through <code>has</code> relationship</li>
                <li><input type="checkbox" disabled checked /> Sort CREATE TABLE statements so that parents come first</li>
                <li><input type="checkbox" disabled checked /> First round of Tests
                  <ul class="list-bullet">
                    <li><input type="checkbox" disabled checked /> Create a test model with children
                      <ul class="list-bullet">
                        <li>Post</li>
                        <li>has one Poll</li>
                        <li>has many Comments</li>
                        <li>has many Reactions</li>
                      </ul>                    </li>
                    <li><input type="checkbox" disabled checked /> populated queries with has_one</li>
                    <li><input type="checkbox" disabled checked /> populated queries with has_many</li>
                    <li><input type="checkbox" disabled checked /> insert with child object</li>
                    <li><input type="checkbox" disabled checked /> update with child object</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> create and update functions should return the resulting objects</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Test passwordless login in Glance &mdash; Feb 14th, 2024</li>
            <li><input type="checkbox" disabled checked /> Test login with password in Glance &mdash; Feb 13th, 2024</li>
            <li><input type="checkbox" disabled checked /> Frontend: Handle validation errors from server &mdash; Feb 11th, 2024</li>
            <li><input type="checkbox" disabled checked /> On validation failure, return the sent data
              <ul class="list-bullet">
                <li>This helps when SvelteKit has forwarded the request straight to the server, since it allows Kit to return the form data back again to repopulate the form</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Command to bootstrap initial org and user &mdash; Feb 11th, 2024
              <ul class="list-bullet">
                <li>This should have the ability to take admin user&#39;s email from either the command line or the environment</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Initial OAuth login support &mdash; Feb 10th, 2024
              <ul class="list-bullet">
                <li><input type="checkbox" disabled checked /> Update create<em class="italic">new</em>user to implement <code>UserCreator</code> trait</li>
                <li><input type="checkbox" disabled checked /> Allow creating a user without an email address</li>
                <li><input type="checkbox" disabled checked /> Look for client id/secret environment variables for each provider and create the ones that are found  &mdash; Feb 3rd, 2024</li>
                <li><input type="checkbox" disabled checked /> Hook up oauth code to endpoints  &mdash; Feb 3rd, 2024</li>
                <li><input type="checkbox" disabled checked /> Link to existing account when it&#39;s a new OAuth login but a known email  &mdash; Feb 2nd, 2024</li>
                <li><input type="checkbox" disabled checked /> Client-side code for OAuth login &mdash; Feb 9th, 2024</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Login page &mdash; Feb 10th, 2024</li>
            <li><input type="checkbox" disabled checked /> Easier way to add new fields to base models than redefining the whole model &mdash; Jan 29th, 2024</li>
            <li><input type="checkbox" disabled checked /> Integrate into <a href="/notes/projects_glance">Glance</a></li>
            <li><input type="checkbox" disabled checked /> User Creation updates &mdash; Jan 27th, 2024
              <ul class="list-bullet">
                <li>Add default role field to org, for users who are added without any set of roles</li>
                <li>Add roles field to email_invites</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Validation for form submissions &mdash; Jan 22nd, 2024</li>
            <li><input type="checkbox" disabled checked /> Use hosts list in post-login redirect processing</li>
            <li><input type="checkbox" disabled checked /> JSON validation that checks multiple fields
              <ul class="list-bullet">
                <li>do this using axum-jsonschema</li>
                <li>Derive <code>schemars::JsonSchema</code> on every structure that might need to be validated</li>
                <li>Might want to add additional validation in the future with an extension to this</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> CORS configuration &mdash; Jan 17th, 2024
              <ul class="list-bullet">
                <li>Host allow list for apps that want to lock to the app&#39;s host</li>
                <li>Use <code>CorsLayer::permissive()</code> on <code>/api</code> for apps that want to expose the API to browsers</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Initial SQL migration should only be written once &mdash; Jan 17th, 2024</li>
            <li><input type="checkbox" disabled checked /> New models should be added in new SQL migrations &mdash; Jan 17th, 2024</li>
            <li><input type="checkbox" disabled checked /> Column changes to models should generate new SQL migrations &mdash; Jan 17th, 2024
              <ul class="list-bullet">
                <li><code>sql-migration-sim</code> crate is written, just need diff functionality</li>
                <li>Add index tracking to <code>sql-migration-sim</code></li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> New runs diff against previous run and only apply diffed changes &mdash; Jan 16th, 2024
              <ul class="list-bullet">
                <li>When running the CLI, save the generated templates (post-formatter) to a state directory</li>
                <li>On each run, diff the generated templates against the previous state in that directory</li>
                <li>Apply that diff to the actual output file
                  <ul class="list-bullet">
                    <li>Need a patch style that matches against nearby lines instead of just using line numbers.</li>
                  </ul>                </li>
                <li>Point out conflicts as they occur, probably use git style merge conflict markers</li>
                <li><code>diffy</code> supports three-way merge so that&#39;s also worth looking at</li>
                <li>This system allows the user to make changes to the generated files but still update the config.</li>
                <li>Need a command to rewrite a particular file</li>
                <li>Need a command to just regenerate the state cache, for when changing formatter settings</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Ability to make signup open to the public or admin-only &mdash; Jan 12th, 2024</li>
            <li><input type="checkbox" disabled checked /> signup endpoint to create a new org that also creates default roles, adds a user, etc. &mdash; Jan 12th, 2024</li>
            <li><input type="checkbox" disabled checked /> ability to sign up via passwordless email auth if enabled &mdash; Jan 12th, 2024</li>
            <li><input type="checkbox" disabled checked /> Password forgot/reset endpoints &mdash; Jan 12th, 2024</li>
            <li><input type="checkbox" disabled checked /> Passwordless email auth &mdash; Jan 11th, 2024</li>
            <li><input type="checkbox" disabled checked /> Email template system &mdash; Jan 11th, 2024</li>
            <li><input type="checkbox" disabled checked /> List all permissions in a file with descriptions &mdash; Jan 9th, 2024</li>
            <li><input type="checkbox" disabled checked /> For models with global permissions, add permissions check in route layer before hitting database &mdash; Jan 9th, 2024</li>
            <li><input type="checkbox" disabled checked /> MVP Basic email sending, enough to do password management and such &mdash; Jan 9th, 2024</li>
            <li><input type="checkbox" disabled checked /> Integrate with email sending services &mdash; Jan 9th, 2024</li>
            <li><input type="checkbox" disabled checked /> Endpoints for retrieving and updating your own user &mdash; Jan 7th, 2024</li>
            <li><input type="checkbox" disabled checked /> Auto-add appropriate dependencies to Cargo.toml &mdash; Jan 7th, 2024</li>
            <li><input type="checkbox" disabled checked /> Tests for users without proper permissions for each action &mdash; Jan 6th, 2024</li>
            <li><input type="checkbox" disabled checked /> Generate tests for models &mdash; Jan 6th, 2024</li>
            <li><input type="checkbox" disabled checked /> Tests for login/logout &mdash; Jan 5th, 2024</li>
            <li><input type="checkbox" disabled checked /> Generate fixtures for tests &mdash; Jan 5th, 2024</li>
            <li><input type="checkbox" disabled checked /> Write functions needed to bootstrap test data &mdash; Jan 4th, 2024
              <ul class="list-bullet">
                <li>These should basically be the version that the actual app will use, just deferring all the surrounding functionality that isn&#39;t needed to write basic tests</li>
                <li>Add org</li>
                <li>Add roles</li>
                <li>Add user to org with roles/permissions</li>
                <li>Add new org (using all the above)</li>
                <li>Add API key for user</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Password login/logout endpoints &mdash; Dec 29th, 2023</li>
            <li><input type="checkbox" disabled checked /> Get server to start &mdash; Dec 27th, 2023</li>
            <li><input type="checkbox" disabled checked /> Add permissions checks to endpoints &mdash; Dec 27th, 2023</li>
            <li><input type="checkbox" disabled checked /> Add app-specific AuthInfo object &mdash; Dec 23rd, 2023</li>
            <li><input type="checkbox" disabled checked /> Add AuthQueries implementation &mdash; Dec 23rd, 2023</li>
            <li><input type="checkbox" disabled checked /> Select queries need to return the current permission level on each object for project/object-level permissions &mdash; Dec 22nd, 2023</li>
            <li><input type="checkbox" disabled checked /> Add middleware layer to do permissions check &mdash; Dec 22nd, 2023</li>
            <li><input type="checkbox" disabled checked /> Add authz middleware to do generic predicate check &mdash; Dec 22nd, 2023</li>
            <li><input type="checkbox" disabled checked /> query to load user/roles/org for auth info &mdash; Dec 21st, 2023</li>
            <li><input type="checkbox" disabled checked /> Generate router for all model endpoints &mdash; Dec 21st, 2023</li>
            <li><input type="checkbox" disabled checked /> Create endpoints for the model &mdash; Dec 20th, 2023</li>
            <li><input type="checkbox" disabled checked /> Bearer token auth middleware &mdash; Dec 20th, 2023</li>
            <li><input type="checkbox" disabled checked /> Session cookie auth middleware &mdash; Dec 20th, 2023</li>
            <li><input type="checkbox" disabled checked /> Figure out querystring filter parameters &mdash; Dec 18th, 2023</li>
            <li><input type="checkbox" disabled checked /> Pagination &mdash; Dec 18th, 2023</li>
            <li><input type="checkbox" disabled checked /> Rename team to organization</li>
            <li><input type="checkbox" disabled checked /> Create Rust structures for each model</li>
            <li><input type="checkbox" disabled checked /> Bootstrap CLI utility</li>
            <li><input type="checkbox" disabled checked /> Figure out main config format</li>
            <li><input type="checkbox" disabled checked /> Figure out model definition</li>
            <li><input type="checkbox" disabled checked /> Create team, user, role, permissions, etc. tables</li>
            <li><input type="checkbox" disabled checked /> Create SQL migration</li>
            <li><input type="checkbox" disabled checked /> Create SQL queries to read/write the model</li>
          </ul>        </li>
      </ul>    </li>
    <li><h3>Setup</h3>
      <ul class="list-bullet">
        <li>This isn&#39;t really full documentation., just notes on how I set things up.  More of this will be automated and rough edges smoothed out over time.</li>
        <li><h4>Initial Setup</h4>
          <ul class="list-bullet">
            <li>Create a git repository</li>
            <li>Create a Rust project in it</li>
            <li>Create a SvelteKit project, add <code>filigree-web</code> as a dependency</li>
            <li>Add the <code>filigree</code> directory with <code>config.toml</code> and other files</li>
            <li>Create a <code>rustfmt.toml</code></li>
            <li>Delete the default <code>src/main.rs</code></li>
            <li>Run <code>filigree</code> to write the source code</li>
            <li>Add this to the vite config
              <ul class="list-bullet">
                <li><pre><code><span class="sy-source sy-js">  <span class="sy-constant sy-other sy-object sy-key sy-js"><span class="sy-string sy-unquoted sy-label sy-js">server</span><span class="sy-punctuation sy-separator sy-key-value sy-js">:</span></span> <span class="sy-meta sy-group sy-braces sy-curly sy-js"><span class="sy-meta sy-brace sy-curly sy-begin sy-js">{</span>
    <span class="sy-constant sy-other sy-object sy-key sy-js"><span class="sy-string sy-unquoted sy-label sy-js">proxy</span><span class="sy-punctuation sy-separator sy-key-value sy-js">:</span></span> <span class="sy-meta sy-group sy-braces sy-curly sy-js"><span class="sy-meta sy-brace sy-curly sy-begin sy-js">{</span>
      <span class="sy-string sy-quoted sy-js"><span class="sy-punctuation sy-definition sy-string sy-begin sy-js">&#39;</span>/api<span class="sy-punctuation sy-definition sy-string sy-end sy-js">&#39;</span></span><span class="sy-punctuation sy-separator sy-key-value sy-js">:</span> <span class="sy-meta sy-group sy-braces sy-curly sy-js"><span class="sy-meta sy-brace sy-curly sy-begin sy-js">{</span>
        <span class="sy-constant sy-other sy-object sy-key sy-js"><span class="sy-string sy-unquoted sy-label sy-js">target</span><span class="sy-punctuation sy-separator sy-key-value sy-js">:</span></span> <span class="sy-string sy-quoted sy-js"><span class="sy-punctuation sy-definition sy-string sy-begin sy-js">&#39;</span>http://localhost:7823<span class="sy-punctuation sy-definition sy-string sy-end sy-js">&#39;</span></span><span class="sy-meta sy-delimiter sy-comma sy-js">,</span>
      <span class="sy-meta sy-brace sy-curly sy-end sy-js">}</span></span><span class="sy-meta sy-delimiter sy-comma sy-js">,</span>
    <span class="sy-meta sy-brace sy-curly sy-end sy-js">}</span></span><span class="sy-meta sy-delimiter sy-comma sy-js">,</span>
  <span class="sy-meta sy-brace sy-curly sy-end sy-js">}</span></span><span class="sy-meta sy-delimiter sy-comma sy-js">,</span>

</span></code></pre></li>
              </ul>            </li>
          </ul>        </li>
        <li><h4>Set up Database</h4>
          <ul class="list-bullet">
            <li>Create Database and Database User
              <ul class="list-bullet">
                <li><code>cat /dev/urandom | head | shasum</code> for an easy random password</li>
                <li><pre><code><span class="sy-source sy-sql"><span class="sy-comment sy-line sy-double-dash sy-sql"><span class="sy-punctuation sy-definition sy-comment sy-sql">--</span> Create the user and database
</span>create role USER login password <span class="sy-string sy-quoted sy-single sy-sql"><span class="sy-punctuation sy-definition sy-string sy-begin sy-sql">&#39;</span>PASSWORD<span class="sy-punctuation sy-definition sy-string sy-end sy-sql">&#39;</span></span>;
<span class="sy-meta sy-create sy-sql"><span class="sy-keyword sy-other sy-create sy-sql">create</span> <span class="sy-keyword sy-other sy-sql">database</span> </span><span class="sy-meta sy-toc-list sy-full-identifier sy-sql">THE_DB with owner </span><span class="sy-meta sy-toc-list sy-full-identifier sy-sql"><span class="sy-entity sy-name sy-function sy-sql">USER</span></span>;
</span></code></pre></li>
                <li>Set <code>DATABASE_URL</code> in your .env</li>
                <li><code>cd YOUR_API_DIRECTORY &amp;&amp; sqlx migrate run</code></li>
              </ul>            </li>
            <li>Bootstrap the Database
              <ul class="list-bullet">
                <li><pre><code><span class="sy-text sy-plain">cargo run --release -- db bootstrap \
  --email YOUR_EMAIL \
  --password &#39;PASSWORD&#39; \
  --name &#39;YOUR NAME&#39; \
  --org-name &#39;ORG NAME&#39;
</span></code></pre></li>
                <li>The only required option is <code>email</code>. Without a password you can log in via OAuth or through a passwordless email login.</li>
                <li>You can also supply a prehashed password by using the <code>--password-hash</code> argument instead, and hashes can be created by running <code>cargo run --release -- util hash-password YOURPASSWORD</code>.</li>
              </ul>            </li>
          </ul>        </li>
      </ul>    </li>
    <li>Authorization
      <ul class="list-bullet">
        <li>Concepts
          <ul class="list-bullet">
            <li>Organization</li>
            <li>User
              <ul class="list-bullet">
                <li>Users can potentially be in multiple organizations</li>
              </ul>            </li>
            <li>Role
              <ul class="list-bullet">
                <li>Basically a collection of permissions</li>
              </ul>            </li>
            <li>Group
              <ul class="list-bullet">
                <li>This is similar to Role</li>
                <li>Might not do this, but it can be useful to make this different when more advanced sharing options are created.</li>
              </ul>            </li>
            <li>Actor - all the things (users, roles, groups) that can have permissions on objects
              <ul class="list-bullet">
                <li>When looking at permissions we gather up all the actors that apply to the current user, and use that whole list for permissions checks</li>
              </ul>            </li>
          </ul>        </li>
        <li>The permissions table is then a list of the permissions each actor has.</li>
        <li>Permissions
          <ul class="list-bullet">
            <li>These should be definable per model once more than one is supported.</li>
            <li>Tables
              <ul class="list-bullet">
                <li>Global permissions
                  <ul class="list-bullet">
                    <li>A many-to-many mapping of actor to permission</li>
                  </ul>                </li>
                <li>Object permissions
                  <ul class="list-bullet">
                    <li>A mapping of actor to object and permission</li>
                    <li>For a project-based model, the projects are also just objects</li>
                  </ul>                </li>
              </ul>            </li>
            <li>Models
              <ul class="list-bullet">
                <li>Role-based Access Control (RBAC)
                  <ul class="list-bullet">
                    <li>Each role has permissions on whether it can read/write/admin certain types of objects.</li>
                    <li>This is the first one we&#39;ll support</li>
                    <li>Might be useful to have two sets of roles, some which can have the global permissions and are only created by administrators, and others which are generic groups of people for managing sharing of projects and objects
                      <ul class="list-bullet">
                        <li>Need to think about how much this needs to be in the data model vs. just something in the UI. Probably just a single boolean flag is sufficient.</li>
                      </ul>                    </li>
                  </ul>                </li>
                <li>Resource-based access control
                  <ul class="list-bullet">
                    <li>Read/write/admin on individual objects</li>
                    <li>Each role/user has specific permissions for each object</li>
                    <li>More complex, need to make sure the relevant entries get added for each object when it is created</li>
                    <li>Best for a model where objects are not shared by default.</li>
                  </ul>                </li>
                <li id="657a981d-8503-427b-a6ab-319c7879b94c">Project-based Access Control
                  <ul class="list-bullet">
                    <li>This combines with the above concepts but is a middle level of granularity compared to the all-or-nothing of plain RBAC and the often-overly-granular resource-based system.</li>
                    <li>A project acts as a container for objects, and actors can have permissions on the project instead of the individual objects.</li>
                    <li>Will probably implement this after RBAC, just need additional functionality for project management and ability to</li>
                    <li>Both individuals and roles can be added to projects</li>
                  </ul>                </li>
                <li>Attribute-based Access Control (ABAC)
                  <ul class="list-bullet">
                    <li>Objects have attributes and actors</li>
                  </ul>                </li>
                <li>Public sharing
                  <ul class="list-bullet">
                    <li>Some sites are built around publicly sharing your stuff.</li>
                    <li>This is basically the same as the resource-based access control model, but with the ability to share with an &quot;anyone&quot; user, and then all the permissions checks check for that actor ID as well.</li>
                    <li>The main change here is that the organization ID checks need to be relaxed when looking for publicly-shared objects.</li>
                  </ul>                </li>
              </ul>            </li>
            <li>Types of default permissions
              <ul class="list-bullet">
                <li>creator only until shared</li>
                <li>Creator gets write access, everyone else gets read access</li>
                <li>everyone can see, only creator can write</li>
                <li>Everyone in the project can see</li>
                <li>Everyone in the project can edit</li>
              </ul>            </li>
          </ul>        </li>
      </ul>    </li>
    <li>Model relationships
      <ul class="list-bullet">
        <li>Types
          <ul class="list-bullet">
            <li>parent-child one to many</li>
            <li>parent-child one to one</li>
            <li>Many to one
              <ul class="list-bullet">
                <li>Usually this isn&#39;t really a parent-child paradigm so much as related objects. This is actually similar to ActiveRecord <code>belongs_to</code> on the parent object, but without the meaning implied by the word &quot;belongs&quot;.</li>
                <li>e.g. Image uploads can all reference a single conversion configuration, but any image can be switched to a different configuration.</li>
                <li>The main thing that we want here is the ability to easily fetch the associated objects instead of just their IDs</li>
              </ul>            </li>
            <li>Many to many
              <ul class="list-bullet">
                <li>Almost always best implemented with a join table</li>
              </ul>            </li>
          </ul>        </li>
        <li>Configuration keywords
          <ul class="list-bullet">
            <li><code>has</code> - For one-to-one or one-to-many parent-child relationships.</li>
            <li><code>has</code> with <code>through</code> for many-to-many relationships
              <ul class="list-bullet">
                <li>In this case <code>through</code> is the name of the model that holds the joins. Making it a full-fledged model allows adding other information to the relationship, if applicable.</li>
                <li>Need a special mode for through models that will omit the normal id field since its primary key will be a composite of the IDs of the two other models.</li>
              </ul>            </li>
            <li><code>references</code> for many-to-one relationships
              <ul class="list-bullet">
                <li>This is actually accomplished by the existing <code>references</code> member on a model field definition.</li>
                <li>Added 2 extra fields that allow setting the option to automatically populate the field on list or get</li>
              </ul>            </li>
          </ul>        </li>
        <li>Where does the linking field actually go?
          <ul class="list-bullet">
            <li>When there&#39;s a linking model, it goes into that model&#39;s table, of course.</li>
            <li>Otherwise for a <code>has</code> relationship it goes into the child object. This is slightly inefficient in a true <code>has_one</code> case but those are rare in practice. In general those turn into either a complex JSON field inside the model itself, or it would be a has_many.</li>
          </ul>        </li>
      </ul>    </li>
    <li>Pricing Plan Support
      <ul class="list-bullet">
        <li>Add pricing tiers and permissions that go along with those tiers - this should mostly be data driven
          <ul class="list-bullet">
            <li>Need ability for numeric values as well (e.g. max 3 projects, 500MB storage, up to 60 minutes of something, etc.)</li>
          </ul>        </li>
        <li>Need ability to do grandfathering of pricing tiers and permissions
          <ul class="list-bullet">
            <li>Essentially this means that both price plans and permissions sets should be versioned, and separately.</li>
            <li>And there should be the ability to update existing plans and all previous versions</li>
          </ul>        </li>
      </ul>    </li>
    <li>Workflows
      <ul class="list-bullet">
        <li>Workflows are basically state machine definitions which can be instantiated with some data, linked to users/orgs/etc.</li>
        <li>Workflows can perform some set of predefined actions, which may include sending emails, notifying a user, spawning other workflows, etc.</li>
        <li>Workflows can define transitions to run after a certain amount of time</li>
        <li>Consider a scripting engine or something for checking state when transitioning (perhaps just reuse a bunch of code from Ergo for this)</li>
      </ul>    </li>
    <li><h2>Old Notes</h2>
      <ul class="list-bullet">
        <li>This should be made modular somehow so it&#39;s easy to maintain and add new stuff.
          <ul class="list-bullet">
            <li>Modules define dependencies</li>
          </ul>        </li>
        <li>Config
          <ul class="list-bullet">
            <li>formatters to use</li>
            <li>SQL dialect (postgres or sqlite)</li>
          </ul>        </li>
        <li>Model definition
          <ul class="list-bullet">
            <li>Write in TOML</li>
            <li>Each field has
              <ul class="list-bullet">
                <li>SQL type</li>
                <li>nullable (default not null)</li>
                <li>Rust type (can be inferred from the SQL type, but can be overridden)</li>
              </ul>            </li>
            <li>Define Indexes and primary key
              <ul class="list-bullet">
                <li>indexes can maybe just be defined in raw sql</li>
              </ul>            </li>
            <li>Can have child relationships, one -to-one and one-to-many</li>
            <li>Can have JSON fields, which deserialize to either JSON values or other Rust structs
              <ul class="list-bullet">
                <li>The rust structs can be defined in the config as strings or something like that</li>
              </ul>            </li>
            <li>List of other query functions to generate (find by field, etc.)</li>
            <li>Permissions
              <ul class="list-bullet">
                <li>Automatic checking on all operations</li>
                <li>Ability to define which permissions are needed for what</li>
              </ul>            </li>
            <li>some kind of hook on update? or is this better done by just changing the generated code myself</li>
          </ul>        </li>
        <li>Consider some kind of codegen for even easier crud endpoint generation
          <ul class="list-bullet">
            <li>Need ability to generate migrations that add/remove columns too
              <ul class="list-bullet">
                <li>this can definitely be manual to start though.</li>
              </ul>            </li>
          </ul>        </li>
        <li>Authentication
          <ul class="list-bullet">
            <li>Need a user/account mapping to support multiple auth methods per user.</li>
          </ul>        </li>
      </ul>    </li>
  </ul>

