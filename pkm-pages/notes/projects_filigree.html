---
title: "Filigree"
tags: Projects
date: 2023-12-09
updated: 2024-03-01
---


  <ul class="list-bullet">
    <li>Filigree is a web app framework based on Rust and SvelteKit, which includes common components such as authentication and background workers, and also makes it easier to set up data models and generate SQL, endpoints, and so on to use them.</li>
    <li><h2>Task List</h2>
      <ul class="list-bullet">
        <li><h3>Up Next</h3>
          <ul class="list-bullet">
            <li><input type="checkbox" disabled  /> Joining tables
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Handle <code>through</code> relationships in fetch queries</li>
                <li><input type="checkbox" disabled  /> Updates in main payload for <code>through</code> relationships</li>
                <li><input type="checkbox" disabled  /> Generate endpoints for managing links in joining tables
                  <ul class="list-bullet">
                    <li>These can just be CRUD endpoints on the linking model. Main difference is the URL structure accounts for the composite ID</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Updates for has_one relationships with ID payload</li>
                <li><input type="checkbox" disabled  /> Updates for has_many relationships with ID payload</li>
              </ul>            </li>
          </ul>        </li>
        <li><h3>Soon</h3>
          <ul class="list-bullet">
            <li><input type="checkbox" disabled  /> Generate Typescript interfaces and JS code to talk to the API</li>
            <li><input type="checkbox" disabled  /> Frontend: Generate client-side validation
              <ul class="list-bullet">
                <li>This is mostly generating the JSON schema into JS, hooking it into <code>ajv</code>, and then making sure that the form submission functions actually use it.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Error reporting
              <ul class="list-bullet">
                <li>Support reporting errors to an external service like Rollbar or Sentry, on both the frontend and backend</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Error page</li>
            <li><input type="checkbox" disabled  /> Reenable endpoints on child models
              <ul class="list-bullet">
                <li>This should mostly work already, but the tests need some additional setup to make a parent object to link to.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Frontend: Project initialization
              <ul class="list-bullet">
                <li>Run sveltekit init command to generate basic project, then fill in files from there.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> tests for list endpoint filtering/pagination/sorting</li>
            <li><input type="checkbox" disabled  /> Set up axum-sqlx-tx?</li>
          </ul>        </li>
        <li><h3>Later/Maybe</h3>
          <ul class="list-bullet">
            <li><input type="checkbox" disabled  /> Add auto-bootstrap option
              <ul class="list-bullet">
                <li>When appropriate environment variables are set, allows the API to do the bootstrapping itself when it first starts up</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Add <code>init</code> command that runs Cargo init, create-svelte, and creates basic config.toml?</li>
            <li>Frontend
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Figure out how best to link Rust side with SvelteKit
                  <ul class="list-bullet">
                    <li>For production, Rust side can have a fallback route which forwards connection to SvelteKit server.
                      <ul class="list-bullet">
                        <li>More complex setups could use a reverse proxy in front of everything but this should be a good default.</li>
                      </ul>                    </li>
                    <li>For dev, easiest to use Vite support and proxy <code>/api</code> to the Rust side</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> App shell with nav bar, etc.</li>
                <li><input type="checkbox" disabled  /> Password reset page</li>
                <li><input type="checkbox" disabled  /> Profile management page</li>
                <li><input type="checkbox" disabled  /> Manage your organization</li>
                <li><input type="checkbox" disabled  /> Default Model editor page</li>
                <li><input type="checkbox" disabled  /> Default Model list page</li>
                <li><input type="checkbox" disabled  /> Admin: invite users to app</li>
                <li><input type="checkbox" disabled  /> Admin: administer organizations</li>
                <li><input type="checkbox" disabled  /> 404 page</li>
              </ul>            </li>
            <li>Template System
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Data-driven default org contents, even if just a JSON blob to start
                  <ul class="list-bullet">
                    <li>This can piggyback off of the fixture system</li>
                    <li>Considering not doing this since it may be simpler to just do it in a function.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Some way to easily add hooks to CRUD operations
                  <ul class="list-bullet">
                    <li>Developer should probably just edit the generated code here.</li>
                    <li>Maybe add stub functions to each model to allow adding pre/post save hooks</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Models can define extra permissions</li>
                <li><input type="checkbox" disabled  /> Models can define custom functions/actions
                  <ul class="list-bullet">
                    <li>Might not do this since it may be worse DX than just adding to generated code</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Make it easy for additional queries to use the permissions macros
                  <ul class="list-bullet">
                    <li>Can suggest using sqlweld here</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Autogenerate belongs_to field if necessary when the inverse has is detected without a through table.
                  <ul class="list-bullet">
                    <li>Currently this returns an error</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Allow disabling child population at runtime in list/get endpoints, when it is enabled by default</li>
                <li><input type="checkbox" disabled  /> Test populated get and list when update<em class="italic">with</em>parent is false</li>
              </ul>            </li>
            <li>Authentication and Registration
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Rate limiting for login-related endpoints
                  <ul class="list-bullet">
                    <li><a href="https://docs.rs/governor/latest/governor/">https://docs.rs/governor/latest/governor/</a></li>
                    <li><a href="https://lib.rs/crates/tower_governor">https://lib.rs/crates/tower_governor</a></li>
                    <li><a href="https://github.com/brandur/redis-cell">https://github.com/brandur/redis-cell</a> if i need this to be distributed
                      <ul class="list-bullet">
                        <li>DragonflyDB is a redis-compatible that has this built-in</li>
                      </ul>                    </li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Passwordless login should include a code that can be pasted into the UI to log in instead.</li>
                <li><input type="checkbox" disabled  /> Password requirements
                  <ul class="list-bullet">
                    <li>length</li>
                    <li>mix of character types</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Prevent reuse of recent passwords</li>
                <li><input type="checkbox" disabled  /> Expire passwords that need a rehash due to upgraded standards</li>
                <li><input type="checkbox" disabled  /> Option to expire passwords after a certain amount of time
                  <ul class="list-bullet">
                    <li>This isn&#39;t recommended practice but some enterprise clients require this in order to sign with you.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Passkeys
                  <ul class="list-bullet">
                    <li><a href="https://passkeys.dev/">https://passkeys.dev/</a></li>
                    <li><a href="https://github.com/1Password/passkey-rs">https://github.com/1Password/passkey-rs</a></li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> RSA timecode Authenticator app</li>
                <li><input type="checkbox" disabled  /> Authenticator Account recovery codes</li>
                <li><input type="checkbox" disabled  /> Account self-deletion</li>
                <li><input type="checkbox" disabled  /> Optional TOS acceptance at registration</li>
                <li><input type="checkbox" disabled  /> Service accounts</li>
                <li><input type="checkbox" disabled  /> Record info about sessions (geoip, user-agent, etc.)</li>
                <li><input type="checkbox" disabled  /> Allow viewing other sessions for your user, and potentially logging them out</li>
                <li><input type="checkbox" disabled  /> Invite users to your team</li>
                <li><input type="checkbox" disabled  /> Invite users to the app, but not in your team</li>
                <li><input type="checkbox" disabled  /> Link a new OAuth login that may not have a matching email to an existing account</li>
                <li><input type="checkbox" disabled  /> When logging in via OAuth, fetch all known emails from the OAuth provider and see if any of them match an existing account if we haven&#39;t seen the account before.
                  <ul class="list-bullet">
                    <li>Need to handle the case where there are multiple emails and they match different accounts. This probably requires an interstitial after the login page to select the matching account.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Waitlist functionality</li>
              </ul>            </li>
            <li>Permissions and Authorization
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> <a class="block-ref" href="/notes/projects_filigree#657a981d-8503-427b-a6ab-319c7879b94c">Project-based Access Control</a></li>
                <li><input type="checkbox" disabled  /> API Key lookup query needs to change to make permissions a subset of the user&#39;s permissions when inherit<em class="italic">user</em>permissions is false
                  <ul class="list-bullet">
                    <li>This way if a user has some permissions removed, they can&#39;t bypass those limits using an old API key which still had those permissions</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Feature flags</li>
                <li><input type="checkbox" disabled  /> Add &quot;all&quot; model permissions so that some roles have permissions on everything even when new models are added.
                  <ul class="list-bullet">
                    <li>This needs some more thought though. Some models like user, org, etc don&#39;t want to have this blanket rule applied. Might be better to just do this via migrations.</li>
                    <li>Better: Have some models use global org-wide permissions of just &quot;read,&quot; &quot;write,&quot; etc. and only specific models have their own set of permissions.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Ability to apply limits on how many objects are created
                  <ul class="list-bullet">
                    <li>There&#39;s a lot of flexibility here, since the limits could be something simple like number of objects, or some derived metric such as &quot;number of minutes&quot; for an audio-based model.</li>
                    <li>The source for the limits could also come from a number of different places, most commonly pricing plan but could be other stuff such as number of community contributions, upvotes, etc.</li>
                    <li>So the question is what&#39;s the proper framework to make it easy to write code that accomplishes all this.
                      <ul class="list-bullet">
                        <li>Make it easy to fetch the limits data.</li>
                        <li>Make it easy to enforce rules around these limits.</li>
                      </ul>                    </li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> API call quotas
                  <ul class="list-bullet">
                    <li>e.g. 3000 calls per month, 20  calls per hour</li>
                    <li>This should be able to group endpoints by categories where they all share a quota</li>
                    <li id="65b71168-ac29-47fc-b3f5-6913e2ea63c2">Might need to do this with a combination of event tracking and a rate limiter</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Usage-based pricing</li>
                <li><input type="checkbox" disabled  /> Ability to add rate limiting on any endpoint
                  <ul class="list-bullet">
                    <li>keyed by org</li>
                    <li>keyed by user</li>
                    <li>endpoints can share a bucket</li>
                    <li>Local tracking is fine at first, should eventually support doing it in Redis or similar to support multiple API servers.</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Ability for admins to assume permissions of other users
                  <ul class="list-bullet">
                    <li>This needs to be audited as well even if nothing else is audited</li>
                  </ul>                </li>
              </ul>            </li>
            <li>Block Storage
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Block storage abstraction
                  <ul class="list-bullet">
                    <li>revisit opendal vs. object_store crates</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> Block storage: Make it easy to return an object as a Response body</li>
                <li><input type="checkbox" disabled  /> Block storage: Option for Uploads via signed URL</li>
                <li><input type="checkbox" disabled  /> File model field type
                  <ul class="list-bullet">
                    <li>Have ability to upload to a block storage url</li>
                    <li>Ability to calculate hash and file size as upload occurs</li>
                  </ul>                </li>
              </ul>            </li>
            <li>Workers
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Define background jobs and generate a helper to enqueue one</li>
                <li><input type="checkbox" disabled  /> Outbox pattern support for running background jobs</li>
                <li><input type="checkbox" disabled  /> Define scheduled tasks that run a job on a cron schedule</li>
              </ul>            </li>
            <li>Notifications
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Notifications: Other types of notifications?</li>
                <li><input type="checkbox" disabled  /> Notifications Internal notifications
                  <ul class="list-bullet">
                    <li>e.g. Discord webhook notifying myself about events</li>
                    <li>This should have notification templates and also destinations for the notifications</li>
                  </ul>                </li>
              </ul>            </li>
            <li>Workflow System
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Build the workflow system
                  <ul class="list-bullet">
                    <li>A lot from <a href="/notes/projects_ergo">Ergo</a> can be reused</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled  /> State chart implementation</li>
                <li><input type="checkbox" disabled  /> Workflows can &quot;sleep&quot; by enqueueing a scheduled task that will continue running when it wakes up</li>
                <li><input type="checkbox" disabled  /> Endpoint to send an event to a workflow</li>
                <li><input type="checkbox" disabled  /> Define workflow actions</li>
                <li><input type="checkbox" disabled  /> Ability to define workflows in the app config</li>
                <li><input type="checkbox" disabled  /> Scripting for Workflows
                  <ul class="list-bullet">
                    <li>Piggyback on Ergo but maybe switch to QuickJS or <a href="https://github.com/saghul/txiki.js">saghul/txiki.js: A tiny JavaScript runtime</a></li>
                  </ul>                </li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> User model list/get functions need to return users which are in multiple orgs, and whose current org is a different one</li>
            <li><input type="checkbox" disabled  /> Easy setup for commercialization</li>
            <li><input type="checkbox" disabled  /> Collect and export metrics to some tool
              <ul class="list-bullet">
                <li>Looks like Honeycomb supports Prometheus format</li>
              </ul>            </li>
            <li>Data Hooks and Similar
              <ul class="list-bullet">
                <li><input type="checkbox" disabled  /> Delete log table for possibility of undelete later</li>
                <li><input type="checkbox" disabled  /> Option for auditing on all operations</li>
              </ul>            </li>
            <li><input type="checkbox" disabled  /> Password confirmation flow for &quot;dangerous&quot; actions</li>
            <li><input type="checkbox" disabled  /> User profile photos</li>
            <li><input type="checkbox" disabled  /> Support HTTPS hosting without a reverse proxy in front</li>
            <li><input type="checkbox" disabled  /> Copy all tests in test-app into filigree crate where it makes sense
              <ul class="list-bullet">
                <li>Some tests are more convenient to test in the test app, but rely on minimal scaffolded functionality. Should add a minimal server/migration setup in filigree crate tests so that they can run there as well.</li>
              </ul>            </li>
          </ul>        </li>
        <li><h3>Done</h3>
          <ul class="list-bullet">
            <li><input type="checkbox" disabled checked /> Create endpoints should return children when doing update<em class="italic">with</em>parent &mdash; Feb 29th, 2024</li>
            <li><input type="checkbox" disabled checked /> <del class="line-through">Store .gen files in a tar file instead</del> - Cancelled Feb 28th, 2024
              <ul class="list-bullet">
                <li>This reduces the huge number of files in the state directory, but makes merge conflicts more difficult to deal with.</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Parent/child model relationships &mdash; Feb 27th, 2024
              <ul class="list-bullet">
                <li><input type="checkbox" disabled checked /> Configuration</li>
                <li><input type="checkbox" disabled checked /> Add fields for <code>belongs_to</code> relationships to model structures</li>
                <li><input type="checkbox" disabled checked /> Generate composite primary key for joining tables and update queries appropriately</li>
                <li><input type="checkbox" disabled checked /> handle has_one relationships in fetch queries with ID fetch</li>
                <li><input type="checkbox" disabled checked /> handle has_one relationships in fetch queries with data fetch</li>
                <li><input type="checkbox" disabled checked /> handle has_many relationships in fetch queries with ID fetch</li>
                <li><input type="checkbox" disabled checked /> handle has_many relationships in fetch queries with data fetch</li>
                <li><input type="checkbox" disabled checked /> Allow populating <code>references</code> fields on fetch when configured</li>
                <li><input type="checkbox" disabled checked /> Updates for has_one relationships with data payload</li>
                <li><input type="checkbox" disabled checked /> Updates for has_many relationships with data payload</li>
                <li><input type="checkbox" disabled checked /> Generate CRUD endpoints for children of a particular object
                  <ul class="list-bullet">
                    <li>This is basically the same as the normal endpoint, but with the parent ID specified in the URL instead of in the payload.</li>
                    <li>When it&#39;s not a many relationship, omit the child ID parameter</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> Populated query functions
                  <ul class="list-bullet">
                    <li><input type="checkbox" disabled checked /> Call populated functions from endpoints when appropriate</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> SQL Queries for child objects
                  <ul class="list-bullet">
                    <li><input type="checkbox" disabled checked /> List by parent ID
                      <ul class="list-bullet">
                        <li>This could be done as just another filter on the list query instead of a new query template</li>
                      </ul>                    </li>
                    <li><input type="checkbox" disabled checked /> insert/update multiple objects</li>
                    <li><input type="checkbox" disabled checked /> Delete by parent ID where ID is not in the set of IDs just inserted/deleted</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> Ensure that each model is not referenced my more than one non-through <code>has</code> relationship</li>
                <li><input type="checkbox" disabled checked /> Sort CREATE TABLE statements so that parents come first</li>
                <li><input type="checkbox" disabled checked /> First round of Tests
                  <ul class="list-bullet">
                    <li><input type="checkbox" disabled checked /> Create a test model with children
                      <ul class="list-bullet">
                        <li>Post</li>
                        <li>has one Poll</li>
                        <li>has many Comments</li>
                        <li>has many Reactions</li>
                      </ul>                    </li>
                    <li><input type="checkbox" disabled checked /> populated queries with has_one</li>
                    <li><input type="checkbox" disabled checked /> populated queries with has_many</li>
                    <li><input type="checkbox" disabled checked /> insert with child object</li>
                    <li><input type="checkbox" disabled checked /> update with child object</li>
                  </ul>                </li>
                <li><input type="checkbox" disabled checked /> create and update functions should return the resulting objects</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Test passwordless login in Glance &mdash; Feb 14th, 2024</li>
            <li><input type="checkbox" disabled checked /> Test login with password in Glance &mdash; Feb 13th, 2024</li>
            <li><input type="checkbox" disabled checked /> Frontend: Handle validation errors from server &mdash; Feb 11th, 2024</li>
            <li><input type="checkbox" disabled checked /> On validation failure, return the sent data
              <ul class="list-bullet">
                <li>This helps when SvelteKit has forwarded the request straight to the server, since it allows Kit to return the form data back again to repopulate the form</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Command to bootstrap initial org and user &mdash; Feb 11th, 2024
              <ul class="list-bullet">
                <li>This should have the ability to take admin user&#39;s email from either the command line or the environment</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Initial OAuth login support &mdash; Feb 10th, 2024
              <ul class="list-bullet">
                <li><input type="checkbox" disabled checked /> Update create<em class="italic">new</em>user to implement <code>UserCreator</code> trait</li>
                <li><input type="checkbox" disabled checked /> Allow creating a user without an email address</li>
                <li><input type="checkbox" disabled checked /> Look for client id/secret environment variables for each provider and create the ones that are found  &mdash; Feb 3rd, 2024</li>
                <li><input type="checkbox" disabled checked /> Hook up oauth code to endpoints  &mdash; Feb 3rd, 2024</li>
                <li><input type="checkbox" disabled checked /> Link to existing account when it&#39;s a new OAuth login but a known email  &mdash; Feb 2nd, 2024</li>
                <li><input type="checkbox" disabled checked /> Client-side code for OAuth login &mdash; Feb 9th, 2024</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Login page &mdash; Feb 10th, 2024</li>
            <li><input type="checkbox" disabled checked /> Easier way to add new fields to base models than redefining the whole model &mdash; Jan 29th, 2024</li>
            <li><input type="checkbox" disabled checked /> Integrate into <a href="/notes/projects_glance">Glance</a></li>
            <li><input type="checkbox" disabled checked /> User Creation updates &mdash; Jan 27th, 2024
              <ul class="list-bullet">
                <li>Add default role field to org, for users who are added without any set of roles</li>
                <li>Add roles field to email_invites</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Validation for form submissions &mdash; Jan 22nd, 2024</li>
            <li><input type="checkbox" disabled checked /> Use hosts list in post-login redirect processing</li>
            <li><input type="checkbox" disabled checked /> JSON validation that checks multiple fields
              <ul class="list-bullet">
                <li>do this using axum-jsonschema</li>
                <li>Derive <code>schemars::JsonSchema</code> on every structure that might need to be validated</li>
                <li>Might want to add additional validation in the future with an extension to this</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> CORS configuration &mdash; Jan 17th, 2024
              <ul class="list-bullet">
                <li>Host allow list for apps that want to lock to the app&#39;s host</li>
                <li>Use <code>CorsLayer::permissive()</code> on <code>/api</code> for apps that want to expose the API to browsers</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Initial SQL migration should only be written once &mdash; Jan 17th, 2024</li>
            <li><input type="checkbox" disabled checked /> New models should be added in new SQL migrations &mdash; Jan 17th, 2024</li>
            <li><input type="checkbox" disabled checked /> Column changes to models should generate new SQL migrations &mdash; Jan 17th, 2024
              <ul class="list-bullet">
                <li><code>sql-migration-sim</code> crate is written, just need diff functionality</li>
                <li>Add index tracking to <code>sql-migration-sim</code></li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> New runs diff against previous run and only apply diffed changes &mdash; Jan 16th, 2024
              <ul class="list-bullet">
                <li>When running the CLI, save the generated templates (post-formatter) to a state directory</li>
                <li>On each run, diff the generated templates against the previous state in that directory</li>
                <li>Apply that diff to the actual output file
                  <ul class="list-bullet">
                    <li>Need a patch style that matches against nearby lines instead of just using line numbers.</li>
                  </ul>                </li>
                <li>Point out conflicts as they occur, probably use git style merge conflict markers</li>
                <li><code>diffy</code> supports three-way merge so that&#39;s also worth looking at</li>
                <li>This system allows the user to make changes to the generated files but still update the config.</li>
                <li>Need a command to rewrite a particular file</li>
                <li>Need a command to just regenerate the state cache, for when changing formatter settings</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Ability to make signup open to the public or admin-only &mdash; Jan 12th, 2024</li>
            <li><input type="checkbox" disabled checked /> signup endpoint to create a new org that also creates default roles, adds a user, etc. &mdash; Jan 12th, 2024</li>
            <li><input type="checkbox" disabled checked /> ability to sign up via passwordless email auth if enabled &mdash; Jan 12th, 2024</li>
            <li><input type="checkbox" disabled checked /> Password forgot/reset endpoints &mdash; Jan 12th, 2024</li>
            <li><input type="checkbox" disabled checked /> Passwordless email auth &mdash; Jan 11th, 2024</li>
            <li><input type="checkbox" disabled checked /> Email template system &mdash; Jan 11th, 2024</li>
            <li><input type="checkbox" disabled checked /> List all permissions in a file with descriptions &mdash; Jan 9th, 2024</li>
            <li><input type="checkbox" disabled checked /> For models with global permissions, add permissions check in route layer before hitting database &mdash; Jan 9th, 2024</li>
            <li><input type="checkbox" disabled checked /> MVP Basic email sending, enough to do password management and such &mdash; Jan 9th, 2024</li>
            <li><input type="checkbox" disabled checked /> Integrate with email sending services &mdash; Jan 9th, 2024</li>
            <li><input type="checkbox" disabled checked /> Endpoints for retrieving and updating your own user &mdash; Jan 7th, 2024</li>
            <li><input type="checkbox" disabled checked /> Auto-add appropriate dependencies to Cargo.toml &mdash; Jan 7th, 2024</li>
            <li><input type="checkbox" disabled checked /> Tests for users without proper permissions for each action &mdash; Jan 6th, 2024</li>
            <li><input type="checkbox" disabled checked /> Generate tests for models &mdash; Jan 6th, 2024</li>
            <li><input type="checkbox" disabled checked /> Tests for login/logout &mdash; Jan 5th, 2024</li>
            <li><input type="checkbox" disabled checked /> Generate fixtures for tests &mdash; Jan 5th, 2024</li>
            <li><input type="checkbox" disabled checked /> Write functions needed to bootstrap test data &mdash; Jan 4th, 2024
              <ul class="list-bullet">
                <li>These should basically be the version that the actual app will use, just deferring all the surrounding functionality that isn&#39;t needed to write basic tests</li>
                <li>Add org</li>
                <li>Add roles</li>
                <li>Add user to org with roles/permissions</li>
                <li>Add new org (using all the above)</li>
                <li>Add API key for user</li>
              </ul>            </li>
            <li><input type="checkbox" disabled checked /> Password login/logout endpoints &mdash; Dec 29th, 2023</li>
            <li><input type="checkbox" disabled checked /> Get server to start &mdash; Dec 27th, 2023</li>
            <li><input type="checkbox" disabled checked /> Add permissions checks to endpoints &mdash; Dec 27th, 2023</li>
            <li><input type="checkbox" disabled checked /> Add app-specific AuthInfo object &mdash; Dec 23rd, 2023</li>
            <li><input type="checkbox" disabled checked /> Add AuthQueries implementation &mdash; Dec 23rd, 2023</li>
            <li><input type="checkbox" disabled checked /> Select queries need to return the current permission level on each object for project/object-level permissions &mdash; Dec 22nd, 2023</li>
            <li><input type="checkbox" disabled checked /> Add middleware layer to do permissions check &mdash; Dec 22nd, 2023</li>
            <li><input type="checkbox" disabled checked /> Add authz middleware to do generic predicate check &mdash; Dec 22nd, 2023</li>
            <li><input type="checkbox" disabled checked /> query to load user/roles/org for auth info &mdash; Dec 21st, 2023</li>
            <li><input type="checkbox" disabled checked /> Generate router for all model endpoints &mdash; Dec 21st, 2023</li>
            <li><input type="checkbox" disabled checked /> Create endpoints for the model &mdash; Dec 20th, 2023</li>
            <li><input type="checkbox" disabled checked /> Bearer token auth middleware &mdash; Dec 20th, 2023</li>
            <li><input type="checkbox" disabled checked /> Session cookie auth middleware &mdash; Dec 20th, 2023</li>
            <li><input type="checkbox" disabled checked /> Figure out querystring filter parameters &mdash; Dec 18th, 2023</li>
            <li><input type="checkbox" disabled checked /> Pagination &mdash; Dec 18th, 2023</li>
            <li><input type="checkbox" disabled checked /> Rename team to organization</li>
            <li><input type="checkbox" disabled checked /> Create Rust structures for each model</li>
            <li><input type="checkbox" disabled checked /> Bootstrap CLI utility</li>
            <li><input type="checkbox" disabled checked /> Figure out main config format</li>
            <li><input type="checkbox" disabled checked /> Figure out model definition</li>
            <li><input type="checkbox" disabled checked /> Create team, user, role, permissions, etc. tables</li>
            <li><input type="checkbox" disabled checked /> Create SQL migration</li>
            <li><input type="checkbox" disabled checked /> Create SQL queries to read/write the model</li>
          </ul>        </li>
      </ul>    </li>
    <li>This should be made modular somehow so it&#39;s easy to maintain and add new stuff.
      <ul class="list-bullet">
        <li>Modules define dependencies</li>
      </ul>    </li>
    <li>Config
      <ul class="list-bullet">
        <li>formatters to use</li>
        <li>SQL dialect (postgres or sqlite)</li>
      </ul>    </li>
    <li>Model definition
      <ul class="list-bullet">
        <li>Write in TOML</li>
        <li>Each field has
          <ul class="list-bullet">
            <li>SQL type</li>
            <li>nullable (default not null)</li>
            <li>Rust type (can be inferred from the SQL type, but can be overridden)</li>
          </ul>        </li>
        <li>Define Indexes and primary key
          <ul class="list-bullet">
            <li>indexes can maybe just be defined in raw sql</li>
          </ul>        </li>
        <li>Can have child relationships, one -to-one and one-to-many</li>
        <li>Can have JSON fields, which deserialize to either JSON values or other Rust structs
          <ul class="list-bullet">
            <li>The rust structs can be defined in the config as strings or something like that</li>
          </ul>        </li>
        <li>List of other query functions to generate (find by field, etc.)</li>
        <li>Permissions
          <ul class="list-bullet">
            <li>Automatic checking on all operations</li>
            <li>Ability to define which permissions are needed for what</li>
          </ul>        </li>
        <li>some kind of hook on update? or is this better done by just changing the generated code myself</li>
      </ul>    </li>
    <li>Consider some kind of codegen for even easier crud endpoint generation
      <ul class="list-bullet">
        <li>Need ability to generate migrations that add/remove columns too
          <ul class="list-bullet">
            <li>this can definitely be manual to start though.</li>
          </ul>        </li>
      </ul>    </li>
    <li>Authentication
      <ul class="list-bullet">
        <li>Need a user/account mapping to support multiple auth methods per user.</li>
      </ul>    </li>
    <li>Authorization
      <ul class="list-bullet">
        <li>Concepts
          <ul class="list-bullet">
            <li>Organization</li>
            <li>User
              <ul class="list-bullet">
                <li>Users can potentially be in multiple organizations</li>
              </ul>            </li>
            <li>Role
              <ul class="list-bullet">
                <li>Basically a collection of permissions</li>
              </ul>            </li>
            <li>Group
              <ul class="list-bullet">
                <li>This is similar to Role</li>
                <li>Might not do this, but it can be useful to make this different when more advanced sharing options are created.</li>
              </ul>            </li>
            <li>Actor - all the things (users, roles, groups) that can have permissions on objects
              <ul class="list-bullet">
                <li>When looking at permissions we gather up all the actors that apply to the current user, and use that whole list for permissions checks</li>
              </ul>            </li>
          </ul>        </li>
        <li>The permissions table is then a list of the permissions each actor has.</li>
        <li>Permissions
          <ul class="list-bullet">
            <li>These should be definable per model once more than one is supported.</li>
            <li>Tables
              <ul class="list-bullet">
                <li>Global permissions
                  <ul class="list-bullet">
                    <li>A many-to-many mapping of actor to permission</li>
                  </ul>                </li>
                <li>Object permissions
                  <ul class="list-bullet">
                    <li>A mapping of actor to object and permission</li>
                    <li>For a project-based model, the projects are also just objects</li>
                  </ul>                </li>
              </ul>            </li>
            <li>Models
              <ul class="list-bullet">
                <li>Role-based Access Control (RBAC)
                  <ul class="list-bullet">
                    <li>Each role has permissions on whether it can read/write/admin certain types of objects.</li>
                    <li>This is the first one we&#39;ll support</li>
                    <li>Might be useful to have two sets of roles, some which can have the global permissions and are only created by administrators, and others which are generic groups of people for managing sharing of projects and objects
                      <ul class="list-bullet">
                        <li>Need to think about how much this needs to be in the data model vs. just something in the UI. Probably just a single boolean flag is sufficient.</li>
                      </ul>                    </li>
                  </ul>                </li>
                <li>Resource-based access control
                  <ul class="list-bullet">
                    <li>Read/write/admin on individual objects</li>
                    <li>Each role/user has specific permissions for each object</li>
                    <li>More complex, need to make sure the relevant entries get added for each object when it is created</li>
                    <li>Best for a model where objects are not shared by default.</li>
                  </ul>                </li>
                <li id="657a981d-8503-427b-a6ab-319c7879b94c">Project-based Access Control
                  <ul class="list-bullet">
                    <li>This combines with the above concepts but is a middle level of granularity compared to the all-or-nothing of plain RBAC and the often-overly-granular resource-based system.</li>
                    <li>A project acts as a container for objects, and actors can have permissions on the project instead of the individual objects.</li>
                    <li>Will probably implement this after RBAC, just need additional functionality for project management and ability to</li>
                    <li>Both individuals and roles can be added to projects</li>
                  </ul>                </li>
                <li>Attribute-based Access Control (ABAC)
                  <ul class="list-bullet">
                    <li>Objects have attributes and actors</li>
                  </ul>                </li>
                <li>Public sharing
                  <ul class="list-bullet">
                    <li>Some sites are built around publicly sharing your stuff.</li>
                    <li>This is basically the same as the resource-based access control model, but with the ability to share with an &quot;anyone&quot; user, and then all the permissions checks check for that actor ID as well.</li>
                    <li>The main change here is that the organization ID checks need to be relaxed when looking for publicly-shared objects.</li>
                  </ul>                </li>
              </ul>            </li>
            <li>Types of default permissions
              <ul class="list-bullet">
                <li>creator only until shared</li>
                <li>Creator gets write access, everyone else gets read access</li>
                <li>everyone can see, only creator can write</li>
                <li>Everyone in the project can see</li>
                <li>Everyone in the project can edit</li>
              </ul>            </li>
          </ul>        </li>
      </ul>    </li>
    <li>Model relationships
      <ul class="list-bullet">
        <li>Types
          <ul class="list-bullet">
            <li>parent-child one to many</li>
            <li>parent-child one to one</li>
            <li>Many to one
              <ul class="list-bullet">
                <li>Usually this isn&#39;t really a parent-child paradigm so much as related objects. This is actually similar to ActiveRecord <code>belongs_to</code> on the parent object, but without the meaning implied by the word &quot;belongs&quot;.</li>
                <li>e.g. Image uploads can all reference a single conversion configuration, but any image can be switched to a different configuration.</li>
                <li>The main thing that we want here is the ability to easily fetch the associated objects instead of just their IDs</li>
              </ul>            </li>
            <li>Many to many
              <ul class="list-bullet">
                <li>Almost always best implemented with a join table</li>
              </ul>            </li>
          </ul>        </li>
        <li>Configuration keywords
          <ul class="list-bullet">
            <li><code>has</code> - For one-to-one or one-to-many parent-child relationships.</li>
            <li><code>has</code> with <code>through</code> for many-to-many relationships
              <ul class="list-bullet">
                <li>In this case <code>through</code> is the name of the model that holds the joins. Making it a full-fledged model allows adding other information to the relationship, if applicable.</li>
                <li>Need a special mode for through models that will omit the normal id field since its primary key will be a composite of the IDs of the two other models.</li>
              </ul>            </li>
            <li><code>references</code> for many-to-one relationships
              <ul class="list-bullet">
                <li>This is actually accomplished by the existing <code>references</code> member on a model field definition.</li>
                <li>Added 2 extra fields that allow setting the option to automatically populate the field on list or get</li>
              </ul>            </li>
          </ul>        </li>
        <li>Where does the linking field actually go?
          <ul class="list-bullet">
            <li>When there&#39;s a linking model, it goes into that model&#39;s table, of course.</li>
            <li>Otherwise for a <code>has</code> relationship it goes into the child object. This is slightly inefficient in a true <code>has_one</code> case but those are rare in practice. In general those turn into either a complex JSON field inside the model itself, or it would be a has_many.</li>
          </ul>        </li>
      </ul>    </li>
    <li>Pricing Plan Support
      <ul class="list-bullet">
        <li>Add pricing tiers and permissions that go along with those tiers - this should mostly be data driven
          <ul class="list-bullet">
            <li>Need ability for numeric values as well (e.g. max 3 projects, 500MB storage, up to 60 minutes of something, etc.)</li>
          </ul>        </li>
        <li>Need ability to do grandfathering of pricing tiers and permissions
          <ul class="list-bullet">
            <li>Essentially this means that both price plans and permissions sets should be versioned, and separately.</li>
            <li>And there should be the ability to update existing plans and all previous versions</li>
          </ul>        </li>
      </ul>    </li>
    <li>Workflows
      <ul class="list-bullet">
        <li>Workflows are basically state machine definitions which can be instantiated with some data, linked to users/orgs/etc.</li>
        <li>Workflows can perform some set of predefined actions, which may include sending emails, notifying a user, spawning other workflows, etc.</li>
        <li>Workflows can define transitions to run after a certain amount of time</li>
        <li>Consider a scripting engine or something for checking state when transitioning (perhaps just reuse a bunch of code from Ergo for this)</li>
      </ul>    </li>
  </ul>

